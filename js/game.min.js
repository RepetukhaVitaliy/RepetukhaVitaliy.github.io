var ModelLevel=Class.create({initialize:function(){},Type:["7","7","1","1"],State:[0,0,0,0],X:[5,5,20,50],Y:[5,20,20,20],Z:[1,0,0,0],vX:[.1,.5,0,-.05],vY:[.1,0,0,.05],vZ:[.1,0,0,.05],SP:[null,null],callFinish:null,isStarted:!1,timeStart:3540,time:null,timeIsUp:!1,inchSize:8,record:null,timeRec:null,autoMove:!1,timeBonus:300,heroBumpImmortalTime:120,timePenalty:180,coinsFounded:0,coinsToSkin2:100,coinsToSkin3:200,productInfo:[],productFounded:0,productBonus:5,messages:[],_levelIndex:0,restart:function(levelIndex){this.record=[],this.timeRec=0,this._levelIndex=levelIndex,this._clearElements(),this.heroRoadIndex=1,this._createHero(),this.moveSpeed=this.moveStartSpeed,this._createElements(this.levelMaps[levelIndex],0),this.time=this.timeStart,this.timeIsUp=!1,this.coinsFounded=0,this.productFounded=0,this.messages=[],this.showFace="_face",this.autoMove=!0,this.isImmortal=!1,this.isStarted=!0},stop:function(){this.isStarted=!1},_optimizeCount:0,tickUpdate:function(){if(0!=this.isStarted){if(this._replayTick(),this.timeRec++,this.timeIsUp&&this._finishTick(),--this.time<0)return this.time=0,void(this.timeIsUp||(this.timeIsUp=!0,this._finish(),window.sounds.pause("gyroscooter"),this.record.push("666:"+this.timeRec)));null!=this._immortalCount&&(++this._immortalCount<this._immortalCountMax?this.isImmortal=!0:(this._immortalCount=null,this.isImmortal=!1)),++this._optimizeCount<2||(this._optimizeCount=0,this._moveElements(),this.time<=0||(this._checkCollisions(),this._checkForAddRoadPart(),this._checkForRemoveBackElements()))}},heroRoadIndex:1,heroIndex:-1,moveStartSpeed:1,moveSpeed:.5,accelerateSpeed:.05,moveSpeedMax:3,timerToSpeedUp:0,heroJumped:null,jumpHeight:3.5,jumpSpeed:2,heroTurnSpeed:.2,heroTurnState:null,heroCurrentSkin:"-",showFace:"",heroMoveForward:function(){},heroMoveBack:function(){},heroStopMove:function(){},heroTurnRight:function(){0!=this.isStarted&&(this.timeIsUp||(this.heroRoadIndex<2&&(this.heroRoadIndex++,this.State[this.heroIndex]=this.heroCurrentSkin+"_R",this.heroTurnState="R",window.sounds.play("left-right")),this.showFace="",this.record.push("3:"+this.timeRec)))},heroTurnLeft:function(){0!=this.isStarted&&(this.timeIsUp||(this.heroRoadIndex>0&&(this.heroRoadIndex--,this.State[this.heroIndex]=this.heroCurrentSkin+"_L",this.heroTurnState="L",window.sounds.play("left-right")),this.showFace="",this.record.push("1:"+this.timeRec)))},heroJump:function(){0!=this.isStarted&&(this.timeIsUp||null!=this.heroJumped||this.Z[this.heroIndex]>.2||(this.heroJumped="up",this.State[this.heroIndex]=this.heroCurrentSkin+"_J",this.showFace="",window.sounds.play("jump"),this.record.push("2:"+this.timeRec)))},_checkToChangeSkin:function(){function skinDone(){_this.messages.push({str:"+ 20 сек",type:1}),setTimeout(function(){_this.autoMove=!0,_this.moveSpeed=_this.moveStartSpeed},1500),_this.record.push("7:"+_this.timeRec)}var _this=this,coins=_this.coinsFounded;coins!=_this.coinsToSkin2&&coins!=_this.coinsToSkin3||(consoleOn&&console.log("_checkToChangeSkin() - start"),_this.autoMove=!1,_this.time+=1200,setTimeout(function(){coins==_this.coinsToSkin2&&(_this.heroCurrentSkin="hL"+(_this._levelIndex+1)+"2",skinDone()),coins==_this.coinsToSkin3&&(_this.heroCurrentSkin="hL"+(_this._levelIndex+1)+"3",skinDone())},1e3))},_gravity:0,_moveElements:function(){""!=this.showFace&&this.time<this.timeStart-30&&(this.showFace=""),++this.timerToSpeedUp>=300&&(this.timerToSpeedUp=0,this.moveSpeed+=.1*this.moveStartSpeed,this.moveSpeed>this.moveSpeedMax&&(this.moveSpeed=this.moveSpeedMax)),this.autoMove?this.vX[this.heroIndex]<this.moveSpeed?this.vX[this.heroIndex]+=this.accelerateSpeed:this.vX[this.heroIndex]=this.moveSpeed:this.vX[this.heroIndex]>0?this.vX[this.heroIndex]-=this.accelerateSpeed/2:this.vX[this.heroIndex]=0;var delY=this.heroRoadIndex*this.inchSize-this.Y[this.heroIndex];this.Y[this.heroIndex]+=delY*this.heroTurnSpeed,Math.abs(delY)<1&&null==this.heroJumped&&(this.State[this.heroIndex]=this.heroCurrentSkin+this.showFace),"up"==this.heroJumped?(this.Z[this.heroIndex]+=this.jumpSpeed*Math.abs(this.Z[this.heroIndex]-this.jumpHeight)/5,this.Z[this.heroIndex]>=this.jumpHeight-.1&&(this.heroJumped="down")):"down"==this.heroJumped&&(this.Z[this.heroIndex]-=this.jumpSpeed*Math.abs(this.Z[this.heroIndex]-this.jumpHeight)/5,this.Z[this.heroIndex]<=.1&&(this.heroJumped=null,this.State[this.heroIndex]=this.heroCurrentSkin+this.showFace,window.sounds.play("landing")));for(var i=0;i<this.Type.length;i++)"0"!=this.Type[i]&&"x"!=this.Type[i]&&(this.X[i]+=this.vX[i],this.Y[i]+=this.vY[i],this.Z[i]+=this.vZ[i],this.Z[i]>0?this.Z[i]-=this._gravity:this.Z[i]=0)},_hitDistance:3,_checkCollisions:function(){for(var i=this.heroIndex,j=0;j<this.X.length;j++)if(j!==i&&Math.abs(this.X[i]-this.X[j])<=this._hitDistance){var _Y1=this.Y[i],_Y2=this.Y[j];if(Math.abs(_Y1-_Y2)<=this._hitDistance){"7"==this.Type[i]&&"w"==this.Type[j]&&this._bounceItAt(i,j);var _Z1=this.Z[i],_Z2=this.Z[j];Math.abs(_Z1-_Z2)<=.05*this._hitDistance&&("7"==this.Type[i]&&"c"==this.Type[j]&&this._getCoin(j),"7"==this.Type[i]&&"l"==this.Type[j]&&this._bounceItAt(i,j),"7"==this.Type[i]&&"t"==this.Type[j]&&this._getTime(i,j),"7"==this.Type[i]&&"p"==this.Type[j]&&this._getProduct(i,j))}}},_immortalCount:null,_immortalCountMax:null,isImmortal:!1,_startImmortal:function(time){this._immortalCount=0,this._immortalCountMax=time},_getCoin:function(j){this.Type[j]="-",this.State[j]="-",this.SP[j]=null,this.coinsFounded++,window.sounds.play("capsule"),this._checkToChangeSkin(),this.messages.push({str:"+",type:2}),this.record.push("5:"+this.timeRec)},_bounceItAt:function(i,j){if(!this.isImmortal){this.X[i]-=2,this.vX[i]=-(.1+.2*this.vX[i]),this.moveSpeed*=.8,this.moveSpeed<this.moveStartSpeed&&(this.moveSpeed=this.moveStartSpeed),this.timerToSpeedUp=0,this.time-=this.timePenalty,this.time<0&&(this.time=0),this._startImmortal(this.heroBumpImmortalTime),this.messages.push({str:"-"+this.timePenalty/60+" сек",type:-1}),window.sounds.play("crash"),this.record.push("6:"+this.timeRec)}},_getTime:function(i,j){this.Type[j]="-",this.State[j]="-",this.SP[j]=null,this.time+=this.timeBonus,this.messages.push({str:"+"+this.timeBonus/60+" сек",type:1}),window.sounds.play("bonus-time"),this.messages.push({str:"+",type:3}),this.record.push("4:"+this.timeRec)},_getProduct:function(i,j){var id=this.State[j][2];this.Type[j]="-",this.State[j]="-",this.SP[j]=null,this.productFounded++,window.GV.showInfo(this._levelIndex,id),window.sounds.play("popup"),this.messages.push({str:"+",type:3+Number(id)});for(var i=0;i<this.productBonus;i++)this.coinsFounded++,this._checkToChangeSkin();this.messages.push({str:"+"+this.productBonus+" баллов",type:1}),this.record.push("10:"+this.timeRec)},_createHero:function(){this._createElement("7",-10*this.inchSize,1*this.inchSize,0,0,0,0),this.heroIndex=this.Type.length-1},_createElement:function(type,X,Y,Z,vX,vY,vZ){this.Type.push(type),this.State.push(this._getElState(type,X,Y,Z)),this.X.push(X),this.Y.push(Y),this.Z.push(Z),this.vX.push(vX),this.vY.push(vY),this.vZ.push(vZ),this.SP.push(null)},_clearElements:function(){this.Type=[],this.State=[],this.X=[],this.Y=[],this.Z=[],this.vX=[],this.vY=[],this.vZ=[],this.SP=[]},_removeElement:function(i){this.Type.splice(i,1),this.State.splice(i,1),this.X.splice(i,1),this.Y.splice(i,1),this.Z.splice(i,1),this.vX.splice(i,1),this.vY.splice(i,1),this.vZ.splice(i,1),this.SP.splice(i,1)},_map:[],_mapWidth:0,_mapHeight:0,_createElements:function(map,delX){this._map=map;var partIndex=Math.round((map.length-1)*Math.random()),partMap=map[partIndex];window.debugRoad&&this._createElement("rp"+(partIndex+1),delX+this.inchSize-1,this.inchSize,.5,0,0,0),this._mapHeight=partMap.length*this.inchSize;for(var _Y=0;_Y<partMap.length;_Y++){var row=partMap[_Y].split("");this._mapWidth=row.length*this.inchSize+delX;for(var _X=0;_X<row.length;_X++){var symbol=row[_X];"-"!=symbol&&this._createElement(symbol,delX+_X*this.inchSize,_Y*this.inchSize,0,0,0,0)}}this.record.push("r"+partIndex+":"+this.timeRec)},_createDistance:150,_checkForAddRoadPart:function(){this.X[this.heroIndex]>this._mapWidth-this._createDistance&&this._createElements(this._map,this._mapWidth)},_checkForRemoveBackCount:0,_checkForRemoveBackElements:function(){if(!(++this._checkForRemoveBackCount<100)){this._checkForRemoveBackCount=0;for(var i=0;i<this.X.length;i++)this.X[i]<this.X[this.heroIndex]-10&&this._removeElement(i)}},_girlFinishObj:null,_finishTick:function(){this.X[this.heroIndex]=this._girlFinishObj.x,this.Y[this.heroIndex]=this._girlFinishObj.y,this.Z[this.heroIndex]-=.8/this.Z[this.heroIndex],this.Z[this.heroIndex]<0&&(this.Z[this.heroIndex]=0)},_finishX:999999999999,_finish:function(){var _this=this;this._finishX=this.X[this.heroIndex]+80,this.showFace="_face",this.heroRoadIndex=1,this.State[this.heroIndex]=this.heroCurrentSkin+this.showFace,this._girlFinishObj={x:this.X[this.heroIndex],y:this.Y[this.heroIndex]};var girlFinishPoint={x:this._finishX-10,y:this.inchSize*this.heroRoadIndex};$j(this._girlFinishObj).animate({x:girlFinishPoint.x,y:girlFinishPoint.y},{duration:3e3,easing:"swing",complete:function(){setTimeout(function(){_this.isStarted=!1,_this.showFace="",_this.State[_this.heroIndex]=_this.heroCurrentSkin,null!=_this.callFinish&&_this.callFinish()},1e3)},step:function(now){}});for(var i=0;i<this.Type.length;i++)this.X[i]>this._finishX-20&&"7"!=this.Type[i]&&"boy1"!=this.Type[i]&&"boy2"!=this.Type[i]&&(this.Type[i]="-",this.State[i]="-")},TestPlaceProducts:function(delay){var _this=this;setTimeout(function(){for(var _X=_this.X[_this.heroIndex]+80,i=0;i<5;i++)_this._createElement("p",_X+_this.inchSize*i*3,2*_this.inchSize,0,0,0,0);for(i=0;i<5;i++)_this._createElement("t",_X+_this.inchSize*i*3,0*_this.inchSize,0,0,0,0)},delay)},TestAllElements:function(delay){var _this=this;setTimeout(function(){for(var i=0;i<3;i++)_this.levelMaps[i]=[],_this.levelMaps[i].push(["clllllwwwtttpppppp","clllllcccwwwtttppp","clllllwwwtttpppppp"])})},_getElState:function(type,X,Y,Z){var state="-";switch(type){case"7":this.heroCurrentSkin="h1def",state=this.heroCurrentSkin;break;case"l":if(0==this._levelIndex&&("b"==(state=(l_states=["b","v","v2","x"])[Math.round(Math.random()*(l_states.length-1))])&&(Y/this.inchSize==1&&(state="b2"),Y/this.inchSize==2&&(state="b3")),"x"==state&&(Y/this.inchSize==1&&(state="x2"),Y/this.inchSize==2&&(state="x3"))),1==this._levelIndex&&(state=(l_states=["p_b1","p_b4"])[Math.round(Math.random()*(l_states.length-1))]),2==this._levelIndex){var l_states=["c_x","c_s1_","c_s2_","c_s3_","c_b1","c_b2"];state=l_states[Math.round(Math.random()*(l_states.length-1))],-1!=["c_x","c_s1_","c_s2_","c_s3_"].indexOf(state)&&(Y/this.inchSize==0&&(state+="2"),Y/this.inchSize==2&&(state+="3"))}break;case"w":if(0==this._levelIndex&&(state="i"),1==this._levelIndex&&(state=(w_states=["p_v","p_b2","p_b3"])[Math.round(Math.random()*(w_states.length-1))]),2==this._levelIndex){var w_states=["c_b3","c_p"];state=w_states[Math.round(Math.random()*(w_states.length-1))]}break;case"p":var p_states=["pd1","pd2","pd3","pd4"];state=p_states[Math.round(Math.random()*(p_states.length-1))];break;case"t":state="clock"}return state},_replayStarted:!1,_recordToReplay:null,_replayEventsCount:null,_nextEvent:null,_startReplay:function(){this._recordToReplay="r5:0,3:72,1:96,5:174,5:190,r7:200,3:223,5:238,5:254,1:270,5:286,3:298,5:318,1:340,5:350,5:366,5:398,1:400,3:428,5:438,5:446,3:448,1:472,5:482,5:510,r2:520,5:526,5:542,3:543,5:558,1:568,5:578,5:590,5:606,5:620,2:624,5:678,2:688,3:721,5:724,5:750,2:751,5:786,5:794,5:810,r2:818,5:824,2:826,5:862,5:868,5:882,1:895,5:926,5:940,5:954,3:988,5:998,5:1012,1:1020,5:1030,5:1042,5:1056,3:1069,5:1086,5:1100,r0:1110,5:1114,2:1119,5:1158,5:1172,1:1180,5:1214,5:1228,5:1242,3:1274,5:1284,5:1294,1:1305,5:1314,5:1322,5:1334,3:1356,1:1377,r5:1384,5:1388,5:1414,2:1415,5:1450,5:1454,3:1465,5:1468,5:1482,1:1488,5:1508,5:1522,3:1529,5:1538,5:1562,5:1574,1:1584,5:1628,5:1642,r5:1650,3:1676,5:1686,5:1694,1:1712,5:1722,3:1733,5:1748,1:1764,5:1774,5:1788,5:1814,2:1816,5:1852,2:1852,5:1888,5:1900,r8:1908,3:1914,5:1936,5:1950,1:1958,5:1974,4:1998,2:1999,5:2036,1:2053,3:2118,5:2122,5:2128,5:2146,r5:2154,5:2158,5:2170,3:2177,5:2196,1:2204,5:2214,5:2220,3:2224,5:2244,5:2256,5:2270,1:2273,3:2298,5:2318,4:2356,1:2360,5:2370,5:2380,5:2392,r2:2400,3:2407,5:2428,5:2438,1:2450,5:2462,4:2484,2:2490,5:2526,1:2533,3:2565,5:2576,2:2578,3:2611,5:2622,r8:2628,5:2632,2:2632,5:2668,5:2676,7:2692,5:2698,1:2835,5:2844,5:2858,3:2895,5:2906,5:2922,1:2932,5:2942,5:2954,5:2970,3:2986,5:3018,r0:3026,1:3026,5:3036,5:3046,3:3057,5:3076,1:3082,5:3092,5:3104,3:3109,5:3134,5:3148,5:3162,1:3162,3:3193,5:3220,4:3264,1:3269,5:3278,r3:3318,5:3322,3:3335,5:3352,1:3376,5:3386,5:3396,5:3410,3:3410,5:3424,1:3437,5:3454,5:3468,3:3480,5:3482,5:3490,5:3512,5:3526,1:3541,3:3561,5:3584,1:3592,r8:3608,5:3612,5:3626,5:3640,2:3641,5:3680,1:3715,5:3724,5:3732,3:3734,5:3760,2:3771,5:3806,3:3837,5:3840,5:3846,5:3866,1:3870,r4:3874,5:3880,5:3892,2:3904,3:3939,5:3940,5:3972,5:3986,1:3996,5:4000,1:4020,5:4030,3:4037,3:4058,4:4092,1:4096,5:4106,3:4117,5:4132,2:4133,r1:4140,5:4172,5:4186,5:4200,2:4202,5:4238,5:4248,1:4262,5:4286,3:4294,1:4320,5:4330,5:4334,5:4346,3:4367,r9:4392,5:4396,1:4411,5:4420,5:4432,1:4441,5:4458,5:4470,5:4506,2:4508,5:4544,5:4556,5:4580,3:4580,5:4606,5:4630,r7:4638,1:4645,4:4680,2:4683,5:4718,5:4728,2:4731,5:4802,3:4833,5:4842,5:4870,r0:4878,5:4882,3:4889,5:4904,1:4914,5:4928,5:4940,3:4945,4:4974,5:4984,5:4996,2:5013,2:5051,1:5103,r3:5106,5:5112,2:5133,5:5168,3:5176,5:5180,5:5190,1:5203,5:5214,5:5224,3:5230,5:5240,5:5260,5:5270,1:5277,3:5298,5:5316,1:5321,r1:5334,5:5340,5:5350,2:5361,5:5396,3:5429,5:5440,1:5449,5:5460,2:5467,5:5502,7:5519,5:5632,3:5632,5:5642,r7:5676,5:5682,1:5694,5:5714,5:5730,1:5743,5:5746,5:5762,5:5778,5:5826,3:5829,1:5849,5:5858,5:5874,5:5890,3:5919,5:5922,5:5928,5:5954,5:5986,r7:5996,5:6002,3:6006,5:6032,1:6041,5:6050,5:6060,5:6076,3:6089,5:6090,4:6118,5:6134,5:6148,2:6166,5:6220,2:6226,5:6278,r8:6288,5:6322,1:6338,5:6352,5:6366,3:6378,5:6380,4:6410,5:6424,5:6438,2:6455,5:6512,2:6518,1:6567,5:6570,5:6576,r4:6578,5:6584,5:6598,3:6609,5:6626,1:6636,5:6646,5:6652,3:6658,5:6680,5:6692,5:6706,2:6707,5:6760,4:6800,1:6801,5:6812,2:6838,r5:6848,3:6868,5:6880,5:6892,5:6906,2:6909,5:6946,5:6960,1:6964,5:7000,5:7012,3:7014,1:7034,5:7042,5:7052,5:7066,5:7092,5:7106,r6:7114,3:7124,5:7146,5:7160,1:7179,5:7188,4:7212,2:7218,5:7254,1:7266,3:7297,1:7309,5:7334,3:7334,5:7346,r8:7366,5:7396,5:7408,2:7409,5:7446,5:7458,5:7470,3:7474,5:7484,2:7515,5:7550,5:7556,5:7606,1:7607,r5:7614,5:7618,5:7630,3:7641,5:7654,5:7704,5:7716,5:7728,2:7729,5:7778,4:7814,1:7816,5:7826,5:7836,5:7848,r3:7854,3:7863,5:7882,5:7894,5:7940,1:7956,5:7966,5:7974,2:7991,5:8026,3:8029,5:8030,1:8058,r7:8084,5:8088,5:8100,2:8106,5:8144,3:8173,5:8190,1:8197,5:8214,2:8222,3:8277,5:8286,5:8304,r2:8312,5:8340,1:8350,5:8362,5:8374,5:8384,3:8384,4:8408,5:8418,5:8428,2:8439,2:8481,5:8516,5:8524,2:8530,r3:8532,5:8568,5:8578,1:8602,5:8612,5:8620,5:8632,3:8657,5:8666,5:8674,1:8685,5:8696,5:8706,3:8716,5:8728,1:8735,r7:8744,5:8748,5:8760,2:8768,5:8804,3:8829,5:8844,1:8853,5:8866,5:8876,2:8878,5:8930,3:8931,5:8952,r7:8958,5:8984,1:8999,5:9008,5:9014,5:9024,3:9025,4:9044,5:9054,5:9064,2:9069,2:9113,5:9154,1:9159,r8:9160,5:9168,3:9172,5:9174,5:9184,1:9189,5:9196,5:9204,5:9214,3:9219,4:9244,5:9254,5:9264,2:9267,2:9312,1:9346,5:9356,r3:9360,5:9364,5:9374,3:9379,5:9394,1:9401,5:9410,5:9414,3:9417,5:9434,5:9444,2:9447,5:9494,1:9522,4:9524,5:9534,r7:9560,5:9564,5:9574,3:9580,5:9584,1:9601,5:9608,5:9614,3:9641,5:9652,1:9657,5:9670,2:9676,3:9722,5:9726,5:9732,5:9746,r9:9752,5:9774,1:9781,5:9792,5:9802,3:9807,4:9830,5:9840,2:9846,2:9895,2:9930,r1:9940,5:9966,5:9972,5:9980,1:9986,5:10000,3:10005,5:10028,1:10034,5:10046,3:10052,5:10094,5:10102,r2:10128,5:10132,1:10139,5:10150,5:10160,1:10161,5:10178,5:10188,3:10205,5:10268,3:10268,5:10294,5:10304,2:10308,r4:10310,5:10344,5:10348,1:10352,5:10374,5:10384,5:10392,1:10400,3:10436,5:10446,5:10454,2:10468,r3:10488,1:10500,5:10504,5:10510,5:10518,2:10549,3:10566,5:10588,2:10590,5:10626,5:10632,3:10644,5:10654,1:10661,r2:10664,5:10668,5:10678,3:10682,1:10702,5:10712,3:10738,5:10748,1:10755,5:10766,2:10771,5:10818,3:10821,5:10830,5:10836,r1:10840,2:10840,5:10878,1:10891,5:10902,5:10912,5:10920,3:10938,5:10948,5:10954,1:10957,5:10964,5:10970,3:10976,5:10978,r6:11008,5:11012,666:11041".split(","),this._replayEventsCount=0,this._nextEvent=null,this._replayStarted=!0},_replayTick:function(){if(this._replayStarted){this._nextEvent&&this._nextEvent[1]==this.timeRec.toString()&&("1"==this._nextEvent[0]&&this.heroTurnLeft(),"2"==this._nextEvent[0]&&this.heroJump(),"3"==this._nextEvent[0]&&this.heroTurnRight(),this._replayEventsCount++);var r=this._recordToReplay[this._replayEventsCount].split(":");this._nextEvent=r}},levelMaps:[[["-ccl-c----ccccl-c-cc","------w------cccl---","---wccccl-cc----c-w-"],["---cc----c---c------","cccw--c---clcclccc--","---lccclcc---w----cw"],["c-w----c-lcccccl-c--","-c-lcccl-w--cc---cc-","--w------cc----c--c-"],["---c-----c---cl-----","-w-ccclclclccc-cccc-","---c---c---w-ccw--c-"],["lccpc-w--cc-c--c-l-c","------lccw----w-ccc-","-----l---cclccccc---"],["--w--w----w----c----","cccl-cccclclcccw---c","----tcc----c--cclcc-"],["-cccpcc----t-ccc---c","--w-l--lccc---wcclc-","--w---w---lccc--cc--"],["ccw-----l----cc----c","------cclccclcccc---","--cclc-tcc---w--c---"],["-lc--------cctccc---","--ccccclcclc---w---c","----ccw-------l-ccc-"],["--c--cw--------ccccc","-ccl-----ctlc--w----","----ccclccc--c-cc---"]],[["-clcc----------cclcc","--c-clcccl-cccw-----","----c----c---c-cc---"],["--ccl--cc--clccc-c--","cw--cccwccl------c-c","--c-----lc---ccclc--"],["------clc---w------c","---ccl---ccc----ccc-","ccclccc----ccwcc----"],["c--w---cclcclcw--c--","--ccclcc-----cclc--c","c--w-----w-c--w--clc"],["-cl-cc---clc-w------","-clc-w-------cclccc-","-cl-ccclccc-p-----cl"],["-w-lcccw--cc-------c","cc-----c-tlcc-clcclc","-w--cc---c--wccw----"],["-clcp--cw----cc---cc","c---ccl-cccccw--tcw-","---------clc---lcc--"],["----c--w-----c---cl-","-cccwccccl--clcc-cl-","-c--c--w--tcc-l--clc"],["-c-w-c------ccclcc--","-ccc-lcclc---------c","-c-w-c---cccl--c--tw"],["--w--tl-ccl----c---c","-c------ccw-cclcclc-","-clcccc----c------cc"]],[["-c-lcc----clcc-w--c-","-w-clclclc-----cclcl","-c--clc--cccw--w----"],["w----wcl--cc-w--c--c","cclccc-wccw-cw-cw-c-","w----l-c--wcccc-w---"],["ccwcwc-w----w--w-ccc","--w---ccclcclccwcc-c","-c-----c----w--lc---"],["-w---cc-lcccc-l--cc-","---w---l--w---ccl--c","-wcw-cccc-w---cclcc-"],["c---c------wcc------","--ccc-wccw---lclclcc","c---ccc-pccw----c---"],["--cc-cc-w---lclc-cc-","-w-t--cccclclclcw---","--cc----w---lclc--c-"],["--w-cccl-----w---lc-","-cccct---ccwcccp--cc","--w-cccl--c--w---lc-"],["-cc-w-----c-clcc--w-","-lc-w-c-tccw---lcccc","----ccw-c-c-clc---w-"],["--w-cc---l--w-cc-clc","c-ccw-ccl-clccl--t-c","-w---c---l----cc-c-c"],["-c-cc---c-cclc--cc--","c--cl-cwcw----ccl-c-","-c-----w-c-tccl-----"]]]}),ViewLevel=Class.create({initialize:function(Model){this.Model=Model,this.init()},Model:null,init:function(){this._initPixiRenderView();var _this=this;setTimeout(function(){_this._loadAssets()},5e3),this._hudTime=document.getElementById("time_hud"),this._hudScore=document.getElementById("score_hud"),this._hudPord=document.getElementById("products_hud");var R=$j("#levelui").find("#circle").attr("width")/2-4;this._timecircle=new CircleLoader($j("#levelui").find("#circle")[0],R,{x:R+4,y:R+4},"#fff",8,"round"),this.initialized=!0},stats:null,initialized:!1,viewWidth:920,viewHeight:520,drawDebugEnable:!1,cameraType:"tail",cameraAtCenter:!0,viewRadius:150,_zSortingEnable:!1,initGraphics:function(){this._clearRender()},startDraw:function(){this._resourceLoaded&&null==this._requestId&&(this._updateHudOptimizeCount=0,this._drawSceneFrame())},stopDraw:function(){null!=this._requestId&&(window.cancelAnimationFrame(this._requestId),this._requestId=null)},onloadComplete:null,onloadProgress:null,getLoadingPercent:function(){return Math.round(PIXI.loader.progress)},_resourcesSprites:[],_resourcesTypeIds:[],_resourcesNames:[],_metterToPixel:30,_requestId:null,_drawSceneFrame:function(){this.stats&&this.stats.update();var _this=this;this._requestId=requestAnimationFrame(function(){_this._drawSceneFrame()}),this.Model.tickUpdate(),this._drawElements(),this._drawEffects(),this._drawFon(),this._zSorting(),this._cameraUpdate(),this._updateUITick(),this.renderer.render(this.stage)},_hudTime:null,_hudScore:null,_hudPord:null,_timecircle:null,_updateHudOptimizeCount:0,_updateUITick:function(){--this._updateHudOptimizeCount<-25&&(this._updateHudOptimizeCount=0,this._hudTime.innerHTML=this._getTimeString(Math.round(this.Model.time/60)),this._hudScore.innerHTML=""+this.Model.coinsFounded,this._hudPord.innerHTML=""+this.Model.productFounded,this._timecircle.draw(this.Model.time/this.Model.timeStart))},renderer:null,stage:null,_initPixiRenderView:function(){this.renderer=PIXI.autoDetectRenderer(this.viewWidth,this.viewHeight,{antialiasing:!1,transparent:!0,resolution:1},!1),this.renderer.view.id="renderCanvas",document.getElementById("game_cont").appendChild(this.renderer.view),this.stage=new PIXI.Container,this.setCanvasSize(),this.renderer.render(this.stage),this._fonCont=new PIXI.Sprite,this.stage.addChild(this._fonCont),this._fonLayer1=new PIXI.Sprite,this._fonCont.addChild(this._fonLayer1),this._fonLayer2=new PIXI.Sprite,this._fonCont.addChild(this._fonLayer2),this._fonLayer3=new PIXI.Sprite,this._fonCont.addChild(this._fonLayer3),this._fonLayer4=new PIXI.Sprite,this._fonCont.addChild(this._fonLayer4),this._fonLayer5=new PIXI.Sprite,this._fonCont.addChild(this._fonLayer5),this._resourceCont=new PIXI.Sprite,this.stage.addChild(this._resourceCont),this._effectsCont=new PIXI.Sprite,this.stage.addChild(this._effectsCont),this._uiCont=new PIXI.Sprite,this.stage.addChild(this._uiCont),this._setupDebug(),this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",window.debugOn&&document.body.appendChild(this.stats.domElement)},setCanvasSize:function(){consoleOn&&console.log("setCanvasSize()");var divW=$j("#game_cont").width(),divH=$j("#game_cont").height();divH<700||isMobile||isTablet,this.renderer.resize(divW,divH),this.renderer.view.style.width=divW+"px",this.renderer.view.style.height=divH+"px"},_resourceLoaded:!1,_assetsPath:"assets/",_loadAssets:function(){function progress(loader,p){null!=_this.onloadProgress&&_this.onloadProgress()}var _this=this,loader=PIXI.loader.add(this._assetsPath+"loc1/fon1.jpg").add(this._assetsPath+"loc1/ball.png").add(this._assetsPath+"loc1/clock.png").add(this._assetsPath+"loc1/product.png").add(this._assetsPath+"loc1/caution1.png").add(this._assetsPath+"loc1/caution2.png").add(this._assetsPath+"loc1/caution3.png").add(this._assetsPath+"loc1/bush.png").add(this._assetsPath+"loc1/bush2.png").add(this._assetsPath+"loc1/bench.png").add(this._assetsPath+"loc1/bench2.png").add(this._assetsPath+"loc1/bench3.png").add(this._assetsPath+"loc1/ice.png").add(this._assetsPath+"loc1/ice_girl1.png").add(this._assetsPath+"loc1/shops_patt1_1.png").add(this._assetsPath+"loc1/shops_patt1_2.png").add(this._assetsPath+"loc1/shops_patt1_3.png").add(this._assetsPath+"loc1/shops_patt2_1.jpg").add(this._assetsPath+"loc1/shops_patt2_2.jpg").add(this._assetsPath+"loc1/shops_patt2_3.jpg").add(this._assetsPath+"loc1/shops_patt3_1.jpg").add(this._assetsPath+"loc1/shops_patt3_2.jpg").add(this._assetsPath+"loc1/shops_patt3_3.jpg").add(this._assetsPath+"loc1/shops_patt4_1.jpg").add(this._assetsPath+"loc1/shops_patt4_2.jpg").add(this._assetsPath+"loc1/shops_patt4_3.jpg").add(this._assetsPath+"loc1/shops_patt5_1.jpg").add(this._assetsPath+"loc1/shops_patt5_2.jpg").add(this._assetsPath+"loc1/shops_patt5_3.jpg").add(this._assetsPath+"loc1/shops_patt6_1.jpg").add(this._assetsPath+"loc1/shops_patt6_2.jpg").add(this._assetsPath+"loc1/shops_patt6_3.jpg").add(this._assetsPath+"loc1/shops_patt7_1.jpg").add(this._assetsPath+"loc1/shops_patt7_2.jpg").add(this._assetsPath+"loc1/shops_patt7_3.jpg").add(this._assetsPath+"loc1/fon_bush.png").add(this._assetsPath+"loc1/fon_light.png").add(this._assetsPath+"loc1/fon_flower1.png").add(this._assetsPath+"loc1/fon_flower2.png").add(this._assetsPath+"loc1/fon_roof.png").add(this._assetsPath+"loc1/depthLight.png").add(this._assetsPath+"loc1/finish1_2.png").add(this._assetsPath+"loc2/bush_park.png").add(this._assetsPath+"loc2/bush2_park.png").add(this._assetsPath+"loc2/girl_vata.png").add(this._assetsPath+"loc2/vata.png").add(this._assetsPath+"loc2/fon2.png").add(this._assetsPath+"loc2/fon_bench2_park.png").add(this._assetsPath+"loc2/fon_fontan.png").add(this._assetsPath+"loc2/fon_tree4.png").add(this._assetsPath+"loc2/fon_tree3.png").add(this._assetsPath+"loc2/fon_tree2.png").add(this._assetsPath+"loc2/fon_tree1.png").add(this._assetsPath+"loc2/fon_bench_park.png").add(this._assetsPath+"loc2/fon_bush_park.png").add(this._assetsPath+"loc2/fon_flower1.png").add(this._assetsPath+"loc2/fon_flower2.png").add(this._assetsPath+"loc2/bush3_park.png").add(this._assetsPath+"loc2/bush4_park.png").add(this._assetsPath+"loc2/fon_bush2_park.png").add(this._assetsPath+"loc2/fon_bush3_park.png").add(this._assetsPath+"loc2/fon_bush4_park.png").add(this._assetsPath+"loc2/fon_fontan2.png").add(this._assetsPath+"loc2/product1.png").add(this._assetsPath+"loc2/product2.png").add(this._assetsPath+"loc2/product3.png").add(this._assetsPath+"loc2/finish1_2.png").add(this._assetsPath+"loc2/treeShadow_01.png").add(this._assetsPath+"loc2/treeShadow_02.png").add(this._assetsPath+"loc3/caution2.png").add(this._assetsPath+"loc3/caution.png").add(this._assetsPath+"loc3/caution3.png").add(this._assetsPath+"loc3/box1.png").add(this._assetsPath+"loc3/box2.png").add(this._assetsPath+"loc3/box3.png").add(this._assetsPath+"loc3/pillar.png").add(this._assetsPath+"loc3/sht1_.png").add(this._assetsPath+"loc3/sht1_2.png").add(this._assetsPath+"loc3/sht1_3.png").add(this._assetsPath+"loc3/sht2_.png").add(this._assetsPath+"loc3/sht2_2.png").add(this._assetsPath+"loc3/sht2_3.png").add(this._assetsPath+"loc3/sht3_.png").add(this._assetsPath+"loc3/sht3_2.png").add(this._assetsPath+"loc3/sht3_3.png").add(this._assetsPath+"loc3/treeL_1.png").add(this._assetsPath+"loc3/treeL_2.png").add(this._assetsPath+"loc3/treeL_3.png").add(this._assetsPath+"loc3/treeR_1.png").add(this._assetsPath+"loc3/treeR_2.png").add(this._assetsPath+"loc3/treeR_3.png").add(this._assetsPath+"loc3/tree_shadow.png").add(this._assetsPath+"loc3/fon_tower1.png").add(this._assetsPath+"loc3/fon_tower2.png").add(this._assetsPath+"loc3/fon_tower3.png").add(this._assetsPath+"loc3/fon_building1.png").add(this._assetsPath+"loc3/fon_building2.png").add(this._assetsPath+"loc3/fon_building3.png").add(this._assetsPath+"loc3/fon_adBox1.png").add(this._assetsPath+"loc3/fon.jpg").add(this._assetsPath+"loc3/fon_building4.png").add(this._assetsPath+"loc3/finish1_2.png").add(this._assetsPath+"loc3/finish_tree.png").add(this._assetsPath+"loc1/floor.png");if(this._addSequnceToLoad("girl/images/def_0",6,".png"),this._addSequnceToLoad("girl/images/loc1_2__0",6,".png"),this._addSequnceToLoad("girl/images/loc1_3__0",6,".png"),this._addSequnceToLoad("girl/images/loc2_2__0",6,".png"),this._addSequnceToLoad("girl/images/loc2_3__0",6,".png"),this._addSequnceToLoad("girl/images/loc3_2__0",6,".png"),this._addSequnceToLoad("girl/images/loc3_3__0",6,".png"),!isMobile)for(var gg=1;gg<8;gg++)this._addSequnceToLoad("girl/def/Char"+gg+"_000",25,".png");loader.add(this._assetsPath+"girl/images/park_girls.png"),this._addSequnceToLoad("boy/images/boy_loc",3,".png"),this._addSequnceToLoad("prod/products1_000",8,".png"),this._addSequnceToLoad("prod/products2_000",8,".png"),this._addSequnceToLoad("prod/products3_000",8,".png"),this._addSequnceToLoad("prod/products4_000",8,".png"),this._addSequnceToLoad("prod/clock_000",8,".png"),this._addSequnceToLoad("eff/trasnform/Transform_fin_000",29,".png"),this._addSequnceToLoad("eff/take/Elm1_PickUp_000",15,".png"),this._addSequnceToLoad("eff/take/Elm2_PickUp_000",15,".png"),this._addSequnceToLoad("eff/take/Elm3_PickUp_000",15,".png"),this._addSequnceToLoad("eff/take/Elm4_PickUp_000",15,".png"),this._addSequnceToLoad("eff/take/Elm5_PickUp_000",15,".png"),this._addSequnceToLoad("eff/take/Elm6_PickUp_000",15,".png"),isMobile||this._addSequnceToLoad("loc2/wheel/Wheel_",300,".png"),loader.load(function(){_this._setup()}),loader.on("progress",progress),loader.once("complete",function(){window.consoleOn&&console.log("pixi images loaded"),null!=_this.onloadComplete&&_this.onloadComplete()})},_addSequnceToLoad:function(pre,num,ape){for(var i=1;i<=num;i++)PIXI.loader.add(this._assetsPath+pre+i+ape)},_fon1floor:null,_setup:function(){this._fonSpriteImg=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/fon1.jpg"].texture);var _fon1=PIXI.loader.resources[this._assetsPath+"loc1/fon1.jpg"].texture;this._fonTextures.push(_fon1);var _fon2=PIXI.loader.resources[this._assetsPath+"loc2/fon2.png"].texture;this._fonTextures.push(_fon2);var _fon3=PIXI.loader.resources[this._assetsPath+"loc3/fon.jpg"].texture;this._fonTextures.push(_fon3),this._fonSprite=new PIXI.Sprite,this._fonSprite.addChild(this._fonSpriteImg),this._fonLayer1.addChild(this._fonSprite),this._fon1floor=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/floor.png"].texture);for(var a=0;a<300;a++)this._fonElements.push([]);for(i=0;i<200;i++){sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/bush2.png"].texture);this._fonElements[120].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1);var sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/fon_bush.png"].texture);this._fonElements[1].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/fon_light.png"].texture),this._fonElements[2].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.75,.25),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/fon_flower1.png"].texture),this._fonElements[3].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,.8),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/fon_flower2.png"].texture),this._fonElements[4].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,.8),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/fon_roof.png"].texture),this._fonElements[5].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(.5,.5);var shopsAnchorY=.9;isMobile&&(shopsAnchorY=.95),isMobile&&isTablet&&(shopsAnchorY=.97),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt1_1.png"].texture),this._fonElements[0].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(0,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt1_2.png"].texture),this._fonElements[6].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(0,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt1_3.png"].texture),this._fonElements[7].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(0,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt2_1.jpg"].texture),this._fonElements[100].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(0,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt2_2.jpg"].texture),this._fonElements[101].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(0,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt2_3.jpg"].texture),this._fonElements[102].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(0,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt3_1.jpg"].texture),this._fonElements[103].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(0,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt3_2.jpg"].texture),this._fonElements[104].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(0,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt3_3.jpg"].texture),this._fonElements[105].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(0,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt4_1.jpg"].texture),this._fonElements[106].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(0,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt4_2.jpg"].texture),this._fonElements[107].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(0,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt4_3.jpg"].texture),this._fonElements[108].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(0,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt5_1.jpg"].texture),this._fonElements[8].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(1,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt5_2.jpg"].texture),this._fonElements[9].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(1,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt5_3.jpg"].texture),this._fonElements[10].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(1,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt6_1.jpg"].texture),this._fonElements[110].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(1,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt6_2.jpg"].texture),this._fonElements[111].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(1,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt6_3.jpg"].texture),this._fonElements[112].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(1,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt7_1.jpg"].texture),this._fonElements[113].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(1,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt7_2.jpg"].texture),this._fonElements[114].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(1,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/shops_patt7_3.jpg"].texture),this._fonElements[115].push(sp),this._fonLayer2.addChild(sp),sp.visible=!1,sp.anchor.set(1,shopsAnchorY),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc1/finish1_2.png"].texture),this._fonElements[50].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,.7),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/treeShadow_01.png"].texture),this._fonElements[48].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.8,.5),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/treeShadow_02.png"].texture),this._fonElements[49].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.8,.5),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/finish1_2.png"].texture),this._fonElements[51].push(sp),this._fonLayer3.addChild(sp),sp.visible=!1,sp.anchor.set(.5,.974);for(var tr=0;tr<2;tr++)sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_tree1.png"].texture),this._fonElements[24].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_tree2.png"].texture),this._fonElements[25].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_tree3.png"].texture),this._fonElements[26].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_tree4.png"].texture),this._fonElements[27].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1);sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_bench_park.png"].texture),this._fonElements[20].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.35,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_bench2_park.png"].texture),this._fonElements[21].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.7,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_fontan.png"].texture),this._fonElements[22].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.7,.84),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_fontan2.png"].texture),this._fonElements[23].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.7,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_bush_park.png"].texture),this._fonElements[30].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_bush2_park.png"].texture),this._fonElements[31].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_bush3_park.png"].texture),this._fonElements[32].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_bush4_park.png"].texture),this._fonElements[33].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_flower1.png"].texture),this._fonElements[34].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc2/fon_flower2.png"].texture),this._fonElements[35].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/treeL_1.png"].texture),this._fonElements[150].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/treeL_2.png"].texture),this._fonElements[151].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/treeL_3.png"].texture),this._fonElements[152].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/treeR_1.png"].texture),this._fonElements[153].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/treeR_2.png"].texture),this._fonElements[154].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/treeR_3.png"].texture),this._fonElements[155].push(sp),this._fonLayer5.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/tree_shadow.png"].texture),this._fonElements[156].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(1,.5),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/fon_tower1.png"].texture),this._fonElements[160].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/fon_tower2.png"].texture),this._fonElements[161].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/fon_tower3.png"].texture),this._fonElements[162].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/fon_building1.png"].texture),this._fonElements[163].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/fon_building2.png"].texture),this._fonElements[164].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/fon_building3.png"].texture),this._fonElements[165].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/fon_building4.png"].texture),this._fonElements[166].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.2,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/fon_adBox1.png"].texture),this._fonElements[167].push(sp),this._fonLayer4.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/finish1_2.png"].texture),this._fonElements[170].push(sp),this._fonLayer3.addChild(sp),sp.visible=!1,sp.anchor.set(.5,.974),sp=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"loc3/finish_tree.png"].texture),this._fonElements[171].push(sp),this._fonLayer3.addChild(sp),sp.visible=!1,sp.anchor.set(.5,1)}for(i=0;i<this._fonElements.length;i++)for(j=0;j<this._fonElements[i].length;j++)this._fonElements[i][j].layerSprite=this._fonElements[i][j].parent,this._fonElements[i][j].parent.removeChild(this._fonElements[i][j]);this._setupResource("c","coin",50,"loc1/ball.png",0,{x:.5,y:.5}),this._setupResource("x","stop",20,"loc1/caution1.png",0,{x:.5,y:.7}),this._setupResource("x2","stop",20,"loc1/caution2.png",0,{x:.5,y:.7}),this._setupResource("x3","stop",20,"loc1/caution3.png",0,{x:.5,y:.7}),this._setupResource("v","bush",20,"loc1/bush.png",0,{x:.5,y:1}),this._setupResource("v2","bush2",20,"loc1/bush2.png",0,{x:.5,y:1}),this._setupResource("b","bench",20,"loc1/bench.png",0,{x:.5,y:1}),this._setupResource("b2","bench2",20,"loc1/bench2.png",0,{x:.5,y:1}),this._setupResource("b3","bench3",20,"loc1/bench3.png",0,{x:.5,y:1}),this._setupResource("i","ice",10,"loc1/ice.png",0,{x:.5,y:1}),this._setupResource("ig","ice_girl",10,"loc1/ice_girl1.png",0,{x:.5,y:1}),this._setupResource("t","time5",20,"loc1/clock.png",0,{x:.5,y:1}),this._setupResource("p","product",20,"loc1/product.png",0,{x:.5,y:1}),this._setupResource("dlight","dlight",10,"loc1/depthLight.png",0,{x:.5,y:.5}),this._setupResource("p_b1","bush_park",10,"loc2/bush_park.png",0,{x:.5,y:1}),this._setupResource("p_b2","bush2_park",10,"loc2/bush2_park.png",0,{x:.5,y:1}),this._setupResource("p_b3","bush3_park",10,"loc2/bush3_park.png",0,{x:.5,y:1}),this._setupResource("p_b4","bush4_park",10,"loc2/bush4_park.png",0,{x:.5,y:1}),this._setupResource("p_gv","girl_vata",10,"loc2/girl_vata.png",0,{x:.5,y:1}),this._setupResource("p_v","vata",10,"loc2/vata.png",0,{x:.5,y:1}),this._setupResource("p21","product",20,"loc2/product1.png",0,{x:.5,y:1}),this._setupResource("p22","product",20,"loc2/product2.png",0,{x:.5,y:1}),this._setupResource("p23","product",20,"loc2/product3.png",0,{x:.5,y:1});var girlAnimParams={speed:1,loop:!0,scenario:[["1",140],["2",50]]};if(isMobile)this._setupResource("h1def","hero1_def",1,"girl/images/def_0.png",3,{x:.5,y:1},.54,girlAnimParams);else{var girlAnimParams2={speed:1,loop:!0,scenario:[["1-25",2]]};this._setupResource("h1def","hero1_def",1,"girl/def/Char1_000.png",25,{x:.5,y:1},.56,girlAnimParams2)}this._setupResource("h1def_J","hero1_def_jump",1,"girl/images/def_04.png",0,{x:.5,y:1},.54),this._setupResource("h1def_R","hero1_def_right",1,"girl/images/def_05.png",0,{x:.5,y:1},.54),this._setupResource("h1def_L","hero1_def_left",1,"girl/images/def_06.png",0,{x:.5,y:1},.54),this._setupResource("h1def_face","hero1_def_left",1,"girl/images/def_01.png",0,{x:.5,y:1},.54);for(var CharAnimIds=[2,4,3,5,6,7],charResizeAnims=[.56,.54,.55,.555,.552,.528],charAnimOffsest=[{x:.5,y:1.03},{x:.5,y:1.03},{x:.5,y:1.03},{x:.5,y:1.03},{x:.5,y:1.03},{x:.5,y:1.1}],CharAnimCount=-1,i=1;i<=3;i++)for(var j=2;j<=3;j++)isMobile?this._setupResource("hL"+i+j,"",1,"girl/images/loc"+i+"_"+j+"__0.png",3,{x:.5,y:1},.54,girlAnimParams):(CharAnimCount++,this._setupResource("hL"+i+j,"",1,"girl/def/Char"+CharAnimIds[CharAnimCount]+"_000.png",25,charAnimOffsest[CharAnimCount],charResizeAnims[CharAnimCount],girlAnimParams2)),this._setupResource("hL"+i+j+"_J","",1,"girl/images/loc"+i+"_"+j+"__04.png",0,{x:.5,y:1},.54),this._setupResource("hL"+i+j+"_R","",1,"girl/images/loc"+i+"_"+j+"__05.png",0,{x:.5,y:1},.54),this._setupResource("hL"+i+j+"_L","",1,"girl/images/loc"+i+"_"+j+"__06.png",0,{x:.5,y:1},.54),this._setupResource("hL"+i+j+"_face","",1,"girl/images/loc"+i+"_"+j+"__01.png",0,{x:.5,y:1},.54);this._setupResource("boy1","boy1",1,"boy/images/boy_loc1.png",0,{x:.5,y:1.2}),this._setupResource("boy2","boy2",1,"girl/images/park_girls.png",0,{x:.5,y:1.2},.5),this._setupResource("boy3","boy3",1,"boy/images/boy_loc3.png",0,{x:.5,y:1.2}),this._setupResource("c_x","",20,"loc3/caution.png",0,{x:.5,y:1}),this._setupResource("c_x2","",20,"loc3/caution2.png",0,{x:.5,y:1}),this._setupResource("c_x3","",20,"loc3/caution3.png",0,{x:.5,y:1}),this._setupResource("c_b1","",20,"loc3/box1.png",0,{x:.5,y:1}),this._setupResource("c_b2","",20,"loc3/box2.png",0,{x:.5,y:1}),this._setupResource("c_b3","",20,"loc3/box3.png",0,{x:.5,y:1}),this._setupResource("c_p","",20,"loc3/pillar.png",0,{x:.5,y:1}),this._setupResource("c_s1_","",20,"loc3/sht1_.png",0,{x:.5,y:1}),this._setupResource("c_s1_2","",20,"loc3/sht1_2.png",0,{x:.5,y:1}),this._setupResource("c_s1_3","",20,"loc3/sht1_3.png",0,{x:.5,y:1}),this._setupResource("c_s2_","",20,"loc3/sht2_.png",0,{x:.5,y:1}),this._setupResource("c_s2_2","",20,"loc3/sht2_2.png",0,{x:.5,y:1}),this._setupResource("c_s2_3","",20,"loc3/sht2_3.png",0,{x:.5,y:1}),this._setupResource("c_s3_","",20,"loc3/sht3_.png",0,{x:.5,y:1}),this._setupResource("c_s3_2","",20,"loc3/sht3_2.png",0,{x:.5,y:1}),this._setupResource("c_s3_3","",20,"loc3/sht3_3.png",0,{x:.5,y:1});var animparams={speed:1,loop:!0,scenario:[["1-8",5]]};this._setupResource("pd1","",20,"prod/products1_000.png",8,{x:.5,y:.5},1,animparams),this._setupResource("pd2","",20,"prod/products2_000.png",8,{x:.5,y:.5},1,animparams),this._setupResource("pd3","",20,"prod/products3_000.png",8,{x:.5,y:.5},1,animparams),this._setupResource("pd4","",20,"prod/products4_000.png",8,{x:.5,y:.5},1,animparams),this._setupResource("clock","",20,"prod/clock_000.png",8,{x:.5,y:.5},1,animparams);var startAnimParams={speed:1,loop:!1,scenario:[["1-29",2]]};this._setupResource("effStars","",5,"eff/trasnform/Transform_fin_000.png",25,{x:.5,y:.5},1,startAnimParams);var takeAnimParams={speed:1,loop:!1,scenario:[["1-14",3]]},takeAnimOffset={x:.5,y:1};if(this._setupResource("takeT","",10,"eff/take/Elm1_PickUp_000.png",15,takeAnimOffset,1,takeAnimParams),this._setupResource("takeB","",10,"eff/take/Elm2_PickUp_000.png",15,takeAnimOffset,1,takeAnimParams),this._setupResource("takeP1","",10,"eff/take/Elm3_PickUp_000.png",15,takeAnimOffset,1,takeAnimParams),this._setupResource("takeP2","",10,"eff/take/Elm4_PickUp_000.png",15,takeAnimOffset,1,takeAnimParams),this._setupResource("takeP3","",10,"eff/take/Elm5_PickUp_000.png",15,takeAnimOffset,1,takeAnimParams),this._setupResource("takeP4","",10,"eff/take/Elm6_PickUp_000.png",15,takeAnimOffset,1,takeAnimParams),isMobile)this._fonWheelSp=new PIXI.Sprite;else{var wheelAnimParams={speed:1,loop:!0,scenario:[["1-300",2]]};this._fonWheelSp=this._createAnimationSprite("loc2/wheel/Wheel_.png",300,{x:.5,y:1},1,wheelAnimParams)}this._resourceLoaded=!0},_clearRender:function(){for(var z=0;z<this._resourcesSprites.length;z++)this._resourcesSprites[z].layerSprite.removeChild(this._resourcesSprites[z]),this._resourcesSprites[z].visible=!1,this._resourcesSprites[z].alpha=1;for(var i=0;i<this._fonElements.length;i++)for(var j=0;j<this._fonElements[i].length;j++)this._fonElements[i][j].layerSprite.removeChild(this._fonElements[i][j]),this._fonElements[i][j].visible=!1,this._fonElements[i][j].alpha=1},_resourceCont:null,_fonCont:null,_fonSprite:null,_fonSpriteImg:null,_fonWheelSp:null,_fonLayer1:null,_fonLayer2:null,_fonLayer3:null,_fonLayer4:null,_fonLayer5:null,_fonTextures:[],_fonElements:[],_uiCont:null,_setupResource:function(typeId,name,count,file,frames,anchor,scaleTexture,animParams){if(0==frames){for(var r1=0;r1<count;r1++){var sprite=this._createSprite(file,anchor,scaleTexture);sprite.layerSprite=this._resourceCont,this._resourcesSprites.push(sprite),this._resourcesTypeIds.push(typeId),this._resourcesNames.push(name)}return sprite}if(frames>0){for(var r2=0;r2<count;r2++){var anim=this._createAnimationSprite(file,frames,anchor,scaleTexture,animParams);anim.layerSprite=this._resourceCont,this._resourcesSprites.push(anim),this._resourcesTypeIds.push(typeId),this._resourcesNames.push(name)}return anim}},_createSprite:function(file,anchor,scaleTexture){var sprite=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+file].texture);return sprite.anchor.set(anchor.x,anchor.y),sprite.visible=!1,sprite.scaleTexture=scaleTexture||1,sprite},_createAnimationSprite:function(file,frames,anchor,scaleTexture,animParams){for(var framesArr=[],i=1;i<=frames;i++){var imgPath=this._assetsPath+file.slice(0,-4)+i+file.substr(-4,4);if(PIXI.loader.resources[imgPath]){var frame=PIXI.loader.resources[imgPath].texture;framesArr.push(frame)}}var anim=new PIXI.extras.AnimatedSprite(framesArr);return anim.anchor.set(anchor.x,anchor.y),anim.isAnimation=!0,anim.timelineUtil=new AnimationTimelineUtil,anim.timelineUtil.setTimeLine(animParams.speed,animParams.loop,animParams.scenario),anim.scaleTexture=scaleTexture||1,anim},_addedToRenderElements:[],_drawElements:function(){for(var z=0;z<this._addedToRenderElements.length;z++)this._addedToRenderElements[z].visible=!1,this._addedToRenderElements[z].alpha=1;this._addedToRenderElements=[],this._zSortingEnable&&(this._zSortElemetsArray=[]);for(var i=0;i<this.Model.Type.length;i++){var typeId=this.Model.Type[i],stateId=this.Model.State[i],linkedSp=this.Model.SP[i],X=this.Model.X[i],Y=this.Model.Y[i],Z=this.Model.Z[i];if(Math.abs(X-this.Model.X[this.Model.heroIndex])<this.viewRadius){if(null!=linkedSp)continue;this.drawDebugEnable&&this._drawDebugElement(i,typeId,X,Y);var sp=this._findFreeResource("-"==stateId?typeId:stateId);null!=sp&&this._drawElement(sp,X,Y,Z,!0)}}},_findFreeResource:function(typeId){var sp=null,j=-1;if(-1!==(j=this._resourcesTypeIds.indexOf(typeId))){for(var k=0;k<99;k++)k<this._resourcesSprites.length-1&&j<this._resourcesSprites.length-1&&(0==this._resourcesSprites[j].visible||j++);sp=this._resourcesSprites[j]}return sp},_findResource:function(typeId){var sp=null,j=-1;return-1!==(j=this._resourcesTypeIds.indexOf(typeId))&&(sp=this._resourcesSprites[j]),sp},_drawElement:function(sp,X,Y,Z,_zSorting){sp.visible=!0,sp.x=X*this._metterToPixel,sp.y=Y*this._metterToPixel,sp.isAnimation&&sp.gotoAndStop(sp.timelineUtil.nextFrame()),this._zSortingEnable&&_zSorting&&this._zSortElemetsArray.push({sp:sp,Z:Y})},_effectsToDraw:[],_drawEffects:function(){for(var r=null,i=0;i<this._effectsToDraw.length;i++){var sp,obj=this._effectsToDraw[i];obj.sp?sp=obj.sp:(sp=this._findFreeResource(obj.id),obj.sp=sp);var X=null,Y=null,Z=null;null!=obj.atPoint&&(X=obj.atPoint.X+obj.offset.X,Y=obj.atPoint.Y+obj.offset.Y,Z=obj.atPoint.Z+obj.offset.Z),null!=obj.linkToIndex&&(X=this.Model.X[obj.linkToIndex]+obj.offset.X,Y=this.Model.Y[obj.linkToIndex]+obj.offset.Y,Z=this.Model.Z[obj.linkToIndex]+obj.offset.Z,obj.fixAtY&&(Y=obj.fixAtY),"Y"==obj.linkToAsix&&(obj.fixAtY=Y)),null!=X&&null!=Y&&null!=Z&&(this._effectsToDraw[i].start&&(sp.timelineUtil.playAtPercent(0),this._effectsToDraw[i].start=!1),1==sp.timelineUtil.playing&&this._drawElement(sp,X,Y,Z,!0)),--this._effectsToDraw[i].liveTime<=0&&(r=i)}null!=r&&this._effectsToDraw.splice(r,1)},blinkSprite:function(sp,speed,time){function frame(){++count>maxcount&&clearInterval(intrv),$j(sp).animate({alpha2:60},{duration:speed,easing:"linear"}).animate({alpha2:100},{duration:speed,easing:"linear"})}sp.alpha2=100;var maxcount=time/(2*speed);frame();var intrv=setInterval(frame,2*speed),count=0},_drawFon:function(){},_cameraUpdate:function(){var heroX=this.Model.X[this.Model.heroIndex]*this._metterToPixel,heroY=this.Model.Y[this.Model.heroIndex]*this._metterToPixel,targetX=-(heroX-this.viewWidth/2*this.cameraAtCenter),targetY=-(heroY-this.viewHeight/2);if("hard"==this.cameraType&&(this._resourceCont.x=targetX,this._resourceCont.y=targetY),"tail"==this.cameraType){var delX=this._resourceCont.x-targetX,delY=this._resourceCont.y-targetY;this._resourceCont.x-=delX/20,this._resourceCont.y-=delY/20}this._debugCont.x=this._resourceCont.x,this._debugCont.y=this._resourceCont.y,this._fonCont.x=this._resourceCont.x,this._fonCont.y=this._resourceCont.y},_zSortElemetsArray:[],_zSortingCount:0,_zSorting:function(){if(this._zSortingEnable&&!(++this._zSortingCount<1)){this._zSortingCount=0,this._zSortElemetsArray.sort(function(a,b){return a.Z-b.Z});for(var i=0;i<this._zSortElemetsArray.length;i++)this._zSortElemetsArray[i].sp.layerSprite.addChild(this._zSortElemetsArray[i].sp)}},_debugCont:null,_debugElements:[],_setupDebug:function(){this._debugCont=new PIXI.Sprite,this.stage.addChild(this._debugCont),this._debugCont.alpha=.5;for(var i=0;i<999;i++){var gr=new PIXI.Graphics;gr.beginFill(16777215,1),gr.drawCircle(0,0,2),gr.endFill(),gr.lineStyle(1,16777215,1);var rw=this.Model.inchSize*this._metterToPixel,rh=rw;gr.drawRect(-rw/2,-rh/2,rw,rh),this._debugCont.addChild(gr),this._debugElements.push(gr),gr.visible=!1}},_drawDebugElement:function(index,typeId,X,Y){if(!(index>this._debugElements.length-1)){var rx=X*this._metterToPixel,ry=Y*this._metterToPixel,alpha=1;"7"==typeId&&(alpha=.5),this._debugElements[index].x=rx,this._debugElements[index].y=ry,this._debugElements[index].visible=!0,this._debugElements[index].alpha=alpha}},arrows:[],_setupMobileControls:function(){var arrow1=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"arrow.png"].texture),arrow2=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"arrow.png"].texture),arrow3=new PIXI.Sprite(PIXI.loader.resources[this._assetsPath+"arrow.png"].texture);this.arrows=[arrow1,arrow2,arrow3];for(var i=0;i<this.arrows.length;i++)this._uiCont.addChild(this.arrows[i]),this.arrows[i].anchor.set(.5,.5),this.arrows[i].interactive=!0,this.arrows[i].buttonMode=!0,this.arrows[i].scale.x=this.arrows[i].scale.y*=3;arrow2.scale.x*=-1,arrow3.rotation=-Math.PI/2;var _thisLink=this;arrow1.on("pointerdown",function(){_thisLink.Model.heroTurnRight()}),arrow2.on("pointerdown",function(){_thisLink.Model.heroTurnLeft()}),arrow3.on("pointerdown",function(){_thisLink.Model.heroJump()}),this._repositionArrows()},_repositionArrows:function(){if(0!=this.arrows.length){var R=35,vW=this.renderer.view.width,vH=this.renderer.view.height;this.arrows[0].x=vW-R,this.arrows[0].y=vH-R,this.arrows[1].x=R,this.arrows[1].y=vH-R,this.arrows[2].x=vW-R,this.arrows[2].y=vH-105}},mobileAdaptRotate:function(){null!=this._canvas&&(console.log("adaptCanvas"),this._canvas.width=200,this._canvas.height=100,this._resize(this._canvas))},_canvas:null,_fullscreenify:function(canvas){var _this=this;this._canvas=canvas,window.addEventListener("resize",function(){_this._resize(canvas)},!0)},_resize:function(canvas){var _this=this,style=canvas.getAttribute("style")||"",scale={x:1,y:1},screeW=$j("#game_cont").width(),screeH=$j("#game_cont").height();scale.x=screeW/canvas.width,scale.y=screeH/canvas.height,scale=scale.x<1||scale.y<1?"1, 1":scale.x<scale.y?scale.x+", "+scale.x:scale.y+", "+scale.y,canvas.setAttribute("style",style+" -ms-transform-origin: center top; -webkit-transform-origin: center top; -moz-transform-origin: center top; -o-transform-origin: center top; transform-origin: center top; -ms-transform: scale("+scale+"); -webkit-transform: scale3d("+scale+", 1); -moz-transform: scale("+scale+"); -o-transform: scale("+scale+"); transform: scale("+scale+");"),_this._repositionArrows(scale)},_getTimeString:function(seconds){var sekStr,min=Math.floor(seconds/60),sek=seconds-60*min;return sekStr=sek>9?""+sek:"0"+sek,"0"+min+":"+sekStr}}),AnimationTimelineUtil=Class.create({initialize:function(){},playing:!0,scenario:[],setTimeLine:function(_speed,_loop,_scenario){this._loop=_loop,this.scenario=_scenario,this._createTimeline()},nextFrame:function(){return this.playing&&(this._count+1<this._timelineFramesIds.length?this._count++:this._loop?this._count=0:this.playing=!1),this._timelineFramesIds[this._count]},playAtPercent:function(percent){this.playing=!0;var _c=Math.round(percent*this._timelineFramesIds.length)-1;this._count=_c},_loop:!1,_speed:1,_count:-1,_timelineFramesIds:[],_createTimeline:function(){this._timelineFramesIds=[];for(var i=0;i<this.scenario.length;i++){var part=this.scenario[i],framesRange=part[0].split("-"),time=part[1];if(1==framesRange.length)for(t=0;t<time;t++){id=Number(framesRange[0]);this._timelineFramesIds.push(id)}else for(var from=Number(framesRange[0]),to=Number(framesRange[1]),j=from;j<=to;j++)for(var id=j,t=0;t<time;t++)this._timelineFramesIds.push(id)}}}),CircleLoader=Class.create({initialize:function(_canvas,_radius,_point,_color,_width,_gap){this.init(_canvas,_radius,_point,_color,_width,_gap)},_ctx:null,_imd:null,_circ:null,_quart:null,_radius:null,_point:null,init:function(_canvas,_radius,_point,_color,_width,_gap){this._radius=_radius,this._point=_point,this._ctx=_canvas.getContext("2d"),this._imd=null,this._circ=2*Math.PI,this._quart=Math.PI/2,this._ctx.beginPath(),this._ctx.strokeStyle=_color,this._ctx.lineCap=_gap,this._ctx.closePath(),this._ctx.fill(),this._ctx.lineWidth=_width,this._imd=this._ctx.getImageData(0,0,2*(_radius+_width),2*(_radius+_width))},draw:function(percent){this._ctx.putImageData(this._imd,0,0),this._ctx.beginPath(),this._ctx.arc(this._point.x,this._point.y,this._radius,-this._quart,this._circ*percent-this._quart,!1),this._ctx.stroke()}}),ViewLevel3d=Class.create(ViewLevel,{initialize:function(Model){this.Model=Model,this.init()},init:function($P_super){this.focus=5e3/this.viewHeight,$P_super(),this.createPlusElements(),this.cameraType="hard",this.cameraAtCenter=!1,this._zSortingEnable=!0,this.viewRadius=300,this._drawLayer1=new PIXI.Graphics,this._setupRoadPartDebug()},startDraw:function($P_super){$P_super(),this._fon1floor.anchor.set(.5,0),this._fonLayer3.addChild(this._fon1floor),this._fonLayer3.addChild(this._drawLayer1),this._changeFon(),this._fon1GraphicsIsPainted=!1},cameraZ:9.2,cameraD:0,focus:10,cameraXzoom:12,cameraYzoom:12,_perspectiveProjection:function(X,Y,Z,focusX,focusY){var p=[0,0];focusY=this.Model.inchSize;var Dx=this.cameraXzoom,Dy=this.cameraYzoom;return p[1]=.35*this.renderer.view.height+(this.cameraZ-Z)*Dx/(X-focusX+this.cameraD)*this._metterToPixel,p[0]=.5*this.renderer.view.width+Dy/(X-focusX+0)*(Y-focusY)*this._metterToPixel,p},_drawElementZoom:1,_drawElement:function(sp,X,Y,Z,_zSortingDo){var heroX=this.Model.X[this.Model.heroIndex]-this.focus,heroY=this.Model.Y[this.Model.heroIndex],p=this._perspectiveProjection(X,Y,Z,heroX,heroY);sp.y=p[1],sp.x=p[0];var scTx=1;if(sp.scaleTexture&&(scTx=sp.scaleTexture),sp.scale.x=sp.scale.y=10/(X-heroX)*this._drawElementZoom*scTx,!(Math.abs(X-this.Model.X[this.Model.heroIndex])>this.viewRadius)){if(sp.visible=!0,sp.layerSprite.addChild(sp),this._addedToRenderElements.push(sp),sp.isAnimation){var frame=sp.timelineUtil.nextFrame();sp.gotoAndStop(frame)}if((sp.scale.x<0||X<heroX-this.focus/2)&&(sp.visible=!1),_zSortingDo){sp.alpha=1;var _outX=this.Model.X[this.Model.heroIndex],_a=1/(_outX-X);_a>1&&(_a=1),_a<0&&(_a=0),X<_outX&&(sp.alpha=_a)}sp.alpha2&&(sp.alpha=sp.alpha2/100),this._zSortingEnable&&_zSortingDo&&this._zSortElemetsArray.push({sp:sp,Z:sp.scale.x/scTx})}},_drawLayer1:null,_drawFon:function(){var heroX=this.Model.X[this.Model.heroIndex]-this.focus,heroY=this.Model.Y[this.Model.heroIndex],centerY=2*this.Model.inchSize/2;this._drawLayer1.clear();var R=12,W=.5,D=this.viewRadius+30;this.Model.timeIsUp&&(D=this.Model._finishX-heroX);var lineColor=15723773;2==this.Model._levelIndex&&(lineColor=4274502);var p1=this._perspectiveProjection(heroX+1,centerY-R,0,heroX,heroY),p2=this._perspectiveProjection(heroX+1,centerY-R+W,0,heroX,heroY),p3=this._perspectiveProjection(heroX+D+10,centerY-R+W,0,heroX,heroY),p4=this._perspectiveProjection(heroX+D+10,centerY-R,0,heroX,heroY);this._drawBorder(this._drawLayer1,p1,p2,p3,p4,lineColor);var p1=this._perspectiveProjection(heroX+1,centerY+R-W,0,heroX,heroY),p2=this._perspectiveProjection(heroX+1,centerY+R,0,heroX,heroY),p3=this._perspectiveProjection(heroX+D+10,centerY+R,0,heroX,heroY),p4=this._perspectiveProjection(heroX+D+10,centerY+R-W,0,heroX,heroY);this._drawBorder(this._drawLayer1,p1,p2,p3,p4,lineColor),0==this.Model._levelIndex&&this._drawFon1(heroX,heroY,centerY,R,W,D),1==this.Model._levelIndex&&this._drawFon2(heroX,heroY,centerY,R,W,D),2==this.Model._levelIndex&&this._drawFon3(heroX,heroY,centerY,R,W,D),this.Model.timeIsUp&&this._drawFinishScene(heroX,heroY,centerY,R,W,D),this._checkMessagesToShow(),this._newChatHintPos(heroX,heroY)},_changeFon:function(){this._fonSpriteImg.texture=this._fonTextures[this.Model._levelIndex],this._fonSprite.addChild(this._fonWheelSp),this._fonWheelSp.x=170,this._fonWheelSp.y=10,this._fonWheelSp.scale.x=this._fonWheelSp.scale.y=1,1!=this.Model._levelIndex&&this._fonSprite.removeChild(this._fonWheelSp),this._fonSpriteImg.anchor.set(.5,.5),this._fonSprite.x=this.renderer.view.width/2,this._fonSprite.y=.4*this.renderer.view.height,window.isMobile&&(this._fonSprite.y=.4*this.renderer.view.height),window.isMobile&&window.isTablet&&(this._fonSprite.y=.39*this.renderer.view.height),this._fonSprite.scale.x=this._fonSprite.scale.y=this.renderer.view.height/560+.1,window.isMobile&&(this._fonSprite.scale.x=this._fonSprite.scale.y=2),window.isMobile&&window.isTablet&&(this._fonSprite.scale.x=this._fonSprite.scale.y=3.4),this._drawLoc1Floor()},_drawLoc1Floor:function(){this._fon1floor.visible=!1,0==this.Model._levelIndex&&(this._fon1floor.visible=!0,this._fon1floor.x=this._fonSprite.x,this._fon1floor.y=this._fonSprite.y,this._fon1floor.scale.x=this._fonSprite.scale.x,this._fon1floor.scale.y=this._fonSprite.scale.y)},_drawFinishScene:function(heroX,heroY,centerY,R,W,D){var X=this.Model._finishX,sp=this._findFreeResource("boy"+(this.Model._levelIndex+1));if(null!=sp&&this._drawElement(sp,X-9.5,centerY+3,0,!0),0==this.Model._levelIndex&&(null!=(sp=this._fonElements[50][0])&&this._drawElement(sp,X,centerY,0,!0),sp.scale.x*=1.5,sp.scale.y*=1.5,sp.alpha=40/(X-heroX)),1==this.Model._levelIndex&&(null!=(sp=this._fonElements[51][0])&&this._drawElement(sp,X+10,centerY,0,!0),sp.scale.x*=2.5,sp.scale.y*=2.5,sp.alpha=40/(X-heroX),null!=(sp=this._fonElements[22][0])&&this._drawElement(sp,X+3,centerY-20,0,!0),sp.scale.x*=1.6,sp.scale.y*=1.6,null!=(sp=this._fonElements[22][1])&&this._drawElement(sp,X+3,centerY+20,0,!0),sp.scale.x*=-1.6,sp.scale.y*=1.6,null!=(sp=this._fonElements[30][0])&&this._drawElement(sp,X-2,centerY+20,0,!0),null!=(sp=this._fonElements[30][1])&&this._drawElement(sp,X-3,centerY+22,0,!0),null!=(sp=this._fonElements[30][2])&&this._drawElement(sp,X-1,centerY-20,0,!0),null!=(sp=this._fonElements[30][3])&&this._drawElement(sp,X-4,centerY-18,0,!0),null!=(sp=this._fonElements[30][4])&&this._drawElement(sp,X-4.5,centerY-22,0,!0),null!=(sp=this._fonElements[30][5])&&this._drawElement(sp,X+3.5,centerY-20,0,!0)),2==this.Model._levelIndex){null!=(sp=this._fonElements[170][0])&&this._drawElement(sp,X,centerY,0,!0),sp.scale.x*=1.5,sp.scale.y*=1.5,sp.alpha=40/(X-heroX);var p1=this._perspectiveProjection(X-1.2,centerY-R,0,heroX,heroY),p2=this._perspectiveProjection(X-1.2,centerY+R,0,heroX,heroY),p3=this._perspectiveProjection(X-1.2+2*W,centerY+R,0,heroX,heroY),p4=this._perspectiveProjection(X-1.2+2*W,centerY-R,0,heroX,heroY);this._drawBorder(this._drawLayer1,p1,p2,p3,p4,4274502);var tSc=1.25;null!=(sp=this._fonElements[150][0])&&this._drawElement(sp,X-2.5,centerY-R-1.5,0,!0),sp.scale.x*=tSc,sp.scale.y*=tSc,null!=(sp=this._fonElements[151][0])&&this._drawElement(sp,X-4.5,centerY-R-1.5,0,!0),sp.scale.x*=tSc,sp.scale.y*=tSc,null!=(sp=this._fonElements[152][0])&&this._drawElement(sp,X-6.5,centerY-R-1.5,0,!0),sp.scale.x*=tSc,sp.scale.y*=tSc,null!=(sp=this._fonElements[153][0])&&this._drawElement(sp,X-2.5,centerY+R+1.5,0,!0),sp.scale.x*=tSc,sp.scale.y*=tSc,null!=(sp=this._fonElements[154][0])&&this._drawElement(sp,X-4.5,centerY+R+1.5,0,!0),sp.scale.x*=tSc,sp.scale.y*=tSc,null!=(sp=this._fonElements[155][0])&&this._drawElement(sp,X-6.5,centerY+R+1.5,0,!0),sp.scale.x*=tSc,sp.scale.y*=tSc,null!=(sp=this._fonElements[171][0])&&this._drawElement(sp,X-2,centerY-R+2,0,!0),sp.scale.x*=1.5,sp.scale.y*=1.5,null!=(sp=this._fonElements[171][1])&&this._drawElement(sp,X-2,centerY+R-2,0,!0),sp.scale.x*=1.5,sp.scale.y*=1.5;null!=(sp=this._fonElements[163][1])&&this._drawElement(sp,X-2,centerY-R-11,0,!0),sp.scale.x*=2.5,sp.scale.y*=2.5,null!=(sp=this._fonElements[164][1])&&this._drawElement(sp,X-6,centerY-R-11,0,!0),sp.scale.x*=2.5,sp.scale.y*=2.5,null!=(sp=this._fonElements[163][1])&&this._drawElement(sp,X-7,centerY+R+11,0,!0),sp.scale.x*=2.5,sp.scale.y*=2.5}},_fon1GraphicsIsPainted:null,_drawFon1:function(heroX,heroY,centerY,R,W,D){R+=W=15;var p1=this._perspectiveProjection(heroX+1,centerY-R,0,heroX,heroY),p2=this._perspectiveProjection(heroX+1,centerY-R+W,0,heroX,heroY),p3=this._perspectiveProjection(heroX+D,centerY-R+W,0,heroX,heroY),p4=this._perspectiveProjection(heroX+D,centerY-R,0,heroX,heroY);this._drawBorder(this._drawLayer1,p1,p2,p3,p4,11046603);var wallHeight=15;window.isMobile&&(wallHeight=8),window.isMobile||this._drawBarrier(this._drawLayer1,heroX+1,centerY-R+W,wallHeight+.5,heroX+D,centerY-R+W,wallHeight+.5,heroX,heroY,D),window.isMobile||this._drawBarrier(this._drawLayer1,heroX+1,centerY+R-W,wallHeight+.5,heroX+D,centerY+R-W,wallHeight+.5,heroX,heroY,D);var p1=this._perspectiveProjection(heroX+1,centerY-R,0,heroX,heroY),p2=this._perspectiveProjection(heroX+1,centerY-R,wallHeight,heroX,heroY),p3=this._perspectiveProjection(heroX+D,centerY-R,wallHeight,heroX,heroY),p4=this._perspectiveProjection(heroX+D,centerY-R,0,heroX,heroY),p1=this._perspectiveProjection(heroX+1,centerY-R,wallHeight,heroX,heroY),p2=this._perspectiveProjection(heroX+1,centerY-R+W,wallHeight,heroX,heroY),p3=this._perspectiveProjection(heroX+D,centerY-R+W,wallHeight,heroX,heroY),p4=this._perspectiveProjection(heroX+D,centerY-R,wallHeight,heroX,heroY);this._drawBorder(this._drawLayer1,p1,p2,p3,p4,9266355);var p1=this._perspectiveProjection(heroX+1,centerY-R+W,wallHeight,heroX,heroY),p2=this._perspectiveProjection(heroX+1,centerY-R+W,wallHeight+.5,heroX,heroY),p3=this._perspectiveProjection(heroX+D,centerY-R+W,wallHeight+.5,heroX,heroY),p4=this._perspectiveProjection(heroX+D,centerY-R+W,wallHeight,heroX,heroY);this._drawBorder(this._drawLayer1,p1,p2,p3,p4,10585035),R=-R+W;var p1=this._perspectiveProjection(heroX+1,centerY-R,0,heroX,heroY),p2=this._perspectiveProjection(heroX+1,centerY-R+W,0,heroX,heroY),p3=this._perspectiveProjection(heroX+D,centerY-R+W,0,heroX,heroY),p4=this._perspectiveProjection(heroX+D,centerY-R,0,heroX,heroY);this._drawBorder(this._drawLayer1,p1,p2,p3,p4,11046603);var p1=this._perspectiveProjection(heroX+1,centerY-R+W,0,heroX,heroY),p2=this._perspectiveProjection(heroX+1,centerY-R+W,wallHeight,heroX,heroY),p3=this._perspectiveProjection(heroX+D,centerY-R+W,wallHeight,heroX,heroY),p4=this._perspectiveProjection(heroX+D,centerY-R+W,0,heroX,heroY),p1=this._perspectiveProjection(heroX+1,centerY-R,wallHeight,heroX,heroY),p2=this._perspectiveProjection(heroX+1,centerY-R+W,wallHeight,heroX,heroY),p3=this._perspectiveProjection(heroX+D,centerY-R+W,wallHeight,heroX,heroY),p4=this._perspectiveProjection(heroX+D,centerY-R,wallHeight,heroX,heroY);this._drawBorder(this._drawLayer1,p1,p2,p3,p4,9266355);var p1=this._perspectiveProjection(heroX+1,centerY-R,wallHeight,heroX,heroY),p2=this._perspectiveProjection(heroX+1,centerY-R,wallHeight+.5,heroX,heroY),p3=this._perspectiveProjection(heroX+D,centerY-R,wallHeight+.5,heroX,heroY),p4=this._perspectiveProjection(heroX+D,centerY-R,wallHeight,heroX,heroY);this._drawBorder(this._drawLayer1,p1,p2,p3,p4,10585035),this._drawPatternRow(this._shopsSideLeftPatt,0,centerY+2*R,-.8,heroX,5,60,-50,0,1.2,!1,D),this._drawPatternRow(this._shopsSideRightPatt,70,centerY-2*R,-.8,heroX,5,60,-50,0,1.2,!1,D),window.isMobile?window.isTablet&&this._drawFonElementsRow(this._fonElements[5],0,6,20,centerY,wallHeight+10,200,heroX,0,!1,D):this._drawFonElementsRow(this._fonElements[5],0,4,20,centerY,wallHeight+10,200,heroX,0,!1,D),this._drawFonElementsRow(this._fonElements[1],0,1,30,centerY+R-4,0,D-50,heroX,0,!1,D),this._drawFonElementsRow(this._fonElements[1],50,1,30,centerY-R+4,0,D-50,heroX,0,!0,D),this._drawFonElementsRow(this._fonElements[120],0,1,60,centerY+R-4,0,D-50,heroX,-45,!1,D),this._drawFonElementsRow(this._fonElements[120],5,1,90,centerY-R+4,0,D-50,heroX,-45,!1,D),this._drawFonElementsRow(this._fonElements[2],0,1,5,centerY+15,wallHeight,250,heroX,0,!1,D),this._drawFonElementsRow(this._fonElements[2],50,1,5,centerY-15,wallHeight,250,heroX,0,!0,D);window.isMobile||this._drawFonElementsRow(this._fonElements[4],0,.8,40,centerY+4,wallHeight,100,heroX+4,2,!1,D),window.isMobile||this._drawFonElementsRow(this._fonElements[4],50,.8,40,centerY-4,wallHeight,100,heroX+4,2,!1,D),this._drawFonElementsRow(this._fonElements[3],0,1.4,40,centerY,wallHeight,100,heroX,0,!1,D),this._drawFonElementsRow(this._fonElements[3],50,.7,40,centerY+6,wallHeight+1,100,heroX,0,!1,D),this._drawFonElementsRow(this._fonElements[3],100,.7,40,centerY-6,wallHeight+1,100,heroX,0,!1,D),this._drawDepthFog(heroX,centerY,D)},_shopsSideLeftPatt:[0,6,7,100,101,102,103,104,105,106,107,108,0,6,7,0,6,7,103,104,105,103,104,105],_shopsSideRightPatt:[8,9,10,8,9,10,110,111,112,8,9,10,110,111,112,113,114,115,8,9,10,8,9,10,113,114,115,8,9,10],_drawBarrier:function(layer,X1,Y1,Z1,X2,Y2,Z2,heroX,heroY,D){var H=1.8;this._drawLine(layer,.2,X1,Y1,Z1+H,X2,Y2,Z2+H,heroX,heroY,11709371,1,0),this._drawLine(layer,.2,X1,Y1,Z1+H-.5,X2,Y2,Z2+H-.5,heroX,heroY,11709371,1,0);for(var viewDistance=D-30,startX=10*Math.round((heroX-15)/10)+30,num=Math.round(viewDistance/10),i=0;i<num;i++){var _X=startX+10*i;this._drawLine(layer,H,_X,Y1,Z1,_X+.2,Y1,Z1,heroX,heroY,11709371,1,0)}},_treesPatt1:[24,25,26,27,24,25,26,27],_treesPatt1Shadows:[49,49,48,49,48,48,49,49,48,49,48,48,49,49,48,49,48,48],_parkSidePattLeft:[21,22,21,32,-1,-1,-1,-1,21,32,21,-1,-1,-1,-1,21,21,-1,-1,32,31,30,21,-1,-1,21,23,21],_parkSidePattRight:[20,30,20,31,-1,31,32,33,31,-1,-1,30,33,-1,-1,30,20,23,20,30,-1,-1,-1,-1,-1,20,32,31],_flowersPattLeft:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,35,35,35,35,35,35,35,35,35,35,35,35,35,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],_flowersPattRight:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,34,34,34,34,34,34,-1,-1,-1,-1,-1,-1,-1,34,34,34,34,34,34,34,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],_drawFon2:function(heroX,heroY,centerY,R,W,D){this.Model.timeIsUp&&(D=this.Model._finishX-heroX);for(var viewDistance=D+10,startX=20*Math.round((heroX-15)/20)+30,num=Math.round(viewDistance/20),i=0;i<num;i++){var _X=startX+20*i,alpha=1;_X>D-50&&(alpha=1),Math.abs(_X-this.Model.X[this.Model.heroIndex])<this.viewRadius&&this._drawLine(this._drawLayer1,400,_X,-200,0,_X+2.5,-200,0,heroX,heroY,16777215,alpha,1)}var p1=this._perspectiveProjection(heroX+1,centerY-R+W,0,heroX,heroY),p2=this._perspectiveProjection(heroX+1,centerY-R+2*R-W,0,heroX,heroY),p3=this._perspectiveProjection(heroX+D+10,centerY-R+2*R-W,0,heroX,heroY),p4=this._perspectiveProjection(heroX+D+10,centerY-R+W,0,heroX,heroY);if(this._drawBorder(this._drawLayer1,p1,p2,p3,p4,16777215),window.isMobile||this._drawPatternRow(this._treesPatt1,0,centerY+8*R,0,heroX,10,10,-60,-1,2,!1,D),window.isMobile||this._drawPatternRow(this._treesPatt1,20,centerY-8*R,0,heroX,10,10,-60,-1,2,!1,D),window.isMobile||this._drawPatternRow(this._treesPatt1Shadows,0,centerY+4*R,0,heroX,10,20,-90,1,2,!1,D),window.isMobile||this._drawPatternRow(this._treesPatt1,50,centerY+4*R,0,heroX,10,20,-90,-1,2,!1,D+10),isMobile&&isTablet&&this._drawPatternRow(this._treesPatt1,50,centerY+8*R,0,heroX,10,20,-90,-1,2,!1,D+10),window.isMobile||this._drawPatternRow(this._treesPatt1Shadows,50,centerY-4*R,0,heroX,10,20,-90,1,2,!1,D),window.isMobile||this._drawPatternRow(this._treesPatt1,100,centerY-4*R,0,heroX,10,20,-90,-1,2,!1,D+10),isMobile&&isTablet&&this._drawPatternRow(this._treesPatt1,100,centerY-8*R,0,heroX,10,20,-90,-1,2,!1,D+10),window.isMobile||this._drawPatternRow(this._treesPatt1Shadows,80,centerY+2.2*R,0,heroX,15,40,-160,1,2.3,!1,D),this._drawPatternRow(this._treesPatt1,250,centerY+2.2*R,0,heroX,15,40,-160,-1,2,!1,D),window.isMobile||this._drawPatternRow(this._treesPatt1Shadows,150,centerY-2.2*R,0,heroX,15,40,-160,1,2,!1,D),this._drawPatternRow(this._treesPatt1,150,centerY-2.2*R,0,heroX,15,40,-160,-1,2,!0,D),this._drawPatternRow(this._parkSidePattLeft,0,centerY-1.6*R,0,heroX,15,80,-150,-1,1.5,!1,D-30),this._drawPatternRow(this._parkSidePattRight,100,centerY+1.6*R,0,heroX,15,80,-150,-1,1.5,!1,D-30),this._drawPatternRow(this._flowersPattLeft,0,centerY-1.15*R,0,heroX,1,100,-5,-1,1.5,!1,D),this._drawPatternRow(this._flowersPattRight,50,centerY+1.15*R,0,heroX,1,100,-5,-1,1.5,!1,D),this._fonWheelSp.visible=!0,this._fonWheelSp.isAnimation){var frame=this._fonWheelSp.timelineUtil.nextFrame();this._fonWheelSp.gotoAndStop(frame)}},_towers2L:[160,161,-1,-1,160,161,162,160,161,-1,-1,160,161,162,160,161,-1],_towersL:[-1,-1,-1,-1,160,161,161,-1,-1,161,-1,160,161,-1,-1,-1,-1],_buildsL:[167,-1,-1,166,163,164,-1,165,-1,163,163,163,164,-1,165,164,-1],_treesL:[-1,-1,-1,-1,150,151,152,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,150,151,152,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],_treesSh:[-1,-1,-1,156,156,156,156,156,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,156,156,156,156,156,-1,-1,-1,-1,-1,-1,-1,-1,-1],_treesR:[-1,-1,-1,-1,153,154,155,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,153,154,155,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],_buildsR:[162,165,167,162,163,164,165,-1,-1,167,-1,-1,166,163,-1,167,-1],_towersR:[-1,-1,160,-1,161,161,-1,-1,162,-1,-1,-1,-1,160,161,162,160],_drawFon3:function(heroX,heroY,centerY,R,W,D){var p1=this._perspectiveProjection(heroX+1,centerY-R+W,0,heroX,heroY),p2=this._perspectiveProjection(heroX+1,centerY-R+2*R-W,0,heroX,heroY),p3=this._perspectiveProjection(heroX+D+10,centerY-R+2*R-W,0,heroX,heroY),p4=this._perspectiveProjection(heroX+D+10,centerY-R+W,0,heroX,heroY);this._drawBorder(this._drawLayer1,p1,p2,p3,p4,8549517),isMobile||this._drawCityRoadTiles(heroX,heroY,centerY,R,W),this._drawPatternRow(this._towers2L,0,centerY-8*R,0,heroX,8,24,-120,-1,3,!1,D+50),this._drawPatternRow(this._towers2L,25,centerY+8*R,0,heroX,8,24,-120,-1,3,!1,D+50),this._drawPatternRow(this._towersL,50,centerY-4*R,0,heroX,10,40,-160,-1,3,!1,D),this._drawPatternRow(this._towersR,100,centerY+4*R,0,heroX,10,40,-160,-1,3,!1,D),this._drawPatternRow(this._buildsL,50,centerY-2.2*R,0,heroX,10,40,-160,-1,3,!0,D),this._drawPatternRow(this._buildsR,100,centerY+2.2*R,0,heroX,10,40,-160,-1,3,!1,D);this._drawPatternRow(this._treesSh,0,centerY-1.2*R+3,0,heroX,7,40,-88,1,1,!1,D-10),this._drawPatternRow(this._treesL,50,centerY-1.2*R,0,heroX,7,40,-90,-1,1,!1,D-10),this._drawPatternRow(this._treesSh,50,centerY+1.2*R+5,0,heroX,7,40,-88,1,1,!1,D-10),this._drawPatternRow(this._treesR,100,centerY+1.2*R,0,heroX,7,40,-90,-1,1,!1,D-10)},_drawCityRoadTiles:function(heroX,heroY,centerY,R,W){function drawTilesLines(oX,oY,color){for(var r_W=2*R,startX=5.5*Math.round((heroX-2)/5.5),i=1;i<7;i++){X=startX+5.5*i+oX;if(i>3&&i%3==0);else{var p1=_this._perspectiveProjection(X,centerY-R+W,0,heroX,heroY),p2=_this._perspectiveProjection(X,centerY+R-W,0,heroX,heroY),p3=_this._perspectiveProjection(X+.1,centerY+R-W,0,heroX,heroY),p4=_this._perspectiveProjection(X+.1,centerY-R+W,0,heroX,heroY);_this._drawBorder(_this._drawLayer1,p1,p2,p3,p4,color);var X=startX+5.5*i+1.5+oX,p1=_this._perspectiveProjection(X,centerY-R+W,0,heroX,heroY),p2=_this._perspectiveProjection(X,centerY+R-W,0,heroX,heroY),p3=_this._perspectiveProjection(X+.1,centerY+R-W,0,heroX,heroY),p4=_this._perspectiveProjection(X+.1,centerY-R+W,0,heroX,heroY);_this._drawBorder(_this._drawLayer1,p1,p2,p3,p4,color)}for(var j=1;j<3;j++){var Y=centerY-R+r_W/3*j+oY,p1=_this._perspectiveProjection(X+4,Y,0,heroX,heroY),p2=_this._perspectiveProjection(X+4,Y+.1,0,heroX,heroY),p3=_this._perspectiveProjection(X,Y+.1,0,heroX,heroY),p4=_this._perspectiveProjection(X,Y,0,heroX,heroY);_this._drawBorder(_this._drawLayer1,p1,p2,p3,p4,color)}X+=4;for(var k=1;k<8;k++){var Y=centerY-R+r_W/8*k+oY,p1=_this._perspectiveProjection(X,Y,0,heroX,heroY),p2=_this._perspectiveProjection(X,Y+.1,0,heroX,heroY),p3=_this._perspectiveProjection(X+1.5,Y+.1,0,heroX,heroY),p4=_this._perspectiveProjection(X+1.5,Y,0,heroX,heroY);_this._drawBorder(_this._drawLayer1,p1,p2,p3,p4,color)}}}var _this=this;drawTilesLines(0,0,9404573),drawTilesLines(.1,.1,7365501)},_drawBorder:function(layer,p1,p2,p3,p4,color,alpha){layer.beginFill(color,alpha),layer.moveTo(p1[0],p1[1]),layer.lineTo(p2[0],p2[1]),layer.lineTo(p3[0],p3[1]),layer.lineTo(p4[0],p4[1]),layer.lineTo(p1[0],p1[1]),layer.endFill()},_drawLine:function(layer,T,X1,Y1,Z1,X2,Y2,Z2,heroX,heroY,color,alpha,vh){var p1=this._perspectiveProjection(X1,Y1+T*vh,Z1,heroX,heroY),p2=this._perspectiveProjection(X2,Y2+T*vh,Z2,heroX,heroY),p3=this._perspectiveProjection(X2,Y2,Z2+T*(1-vh),heroX,heroY),p4=this._perspectiveProjection(X1,Y1,Z1+T*(1-vh),heroX,heroY);this._drawBorder(this._drawLayer1,p1,p2,p3,p4,color)},_drawFonElementsRow:function(sprites,startIndex,size,deltaX,Y,Z,viewDistance,heroX,offsetX,flip,D){for(var startX=Math.round((heroX-15)/deltaX)*deltaX+offsetX,num=Math.round(viewDistance/deltaX),i=0;i<num;i++){var sp=sprites[startIndex+i],X=startX+(num-i)*deltaX;this._drawElement(sp,X,Y,Z),sp.scale.x*=size,sp.scale.y*=size,flip&&(sp.scale.x=-sp.scale.x),X>heroX+D&&(sp.alpha=0)}},_drawPatternRow:function(patt,startIndexSprites,Y,Z,heroX,deltaX,num,offsetX,isPlane,scale,flip,D){for(var startPos=Math.round(heroX/deltaX)+10,prewSp=null,i=0;i<num;i++){var index=startPos+(num-i),indexPatt=index-Math.floor(index/patt.length)*patt.length;if(-1!=patt[indexPatt]){var sp=this._fonElements[patt[indexPatt]][startIndexSprites+i],X=index*deltaX+offsetX;if(0==isPlane){heroX+40-X>0&&(X+=0)}this._drawElement(sp,X,Y,Z),sp.scale.x*=scale,flip&&(sp.scale.x*=-1),sp.scale.y*=scale,X>heroX+D&&(sp.alpha=0),-1!=isPlane&&(null==prewSp?sp.alpha=0:(0==isPlane&&(sp.width=Math.abs(sp.x-prewSp.x),0==this.Model._levelIndex&&this.Model.timeIsUp&&(sp.alpha=.02*Math.abs(this.Model._finishX-X)*2)),1==isPlane&&(sp.height=1.4*Math.abs(sp.y-prewSp.y)))),0==i&&(sp.alpha=0),prewSp=sp}else-1!=isPlane&&(null!=prewSp&&(prewSp.alpha=0),prewSp=null)}},_drawDepthFog:function(heroX,centerY,D){for(var i=0;i<10;i++){var X=heroX+150+10*i,sp=this._findFreeResource("dlight");null!=sp&&X<heroX+D&&(this._drawElement(sp,X,centerY,0,!0),sp.scale.x*=10,sp.scale.y*=10)}},plusElements:[],minusElements:[],createPlusElements:function(){var fontName="ProximaNovaExtrabold";"firefox"==window.browserName&&(fontName="Tahoma");for(i=0;i<9;i++)(txt=new PIXI.Text("text",{fontWeight:"bold",fontSize:50,fontFamily:fontName,fill:"#9b3dd2",align:"center",stroke:"#eccbf2",strokeThickness:3})).visible=!1,this._effectsCont.addChild(txt),this.plusElements.push(txt);for(var i=0;i<9;i++){var txt=new PIXI.Text("text",{fontWeight:"bold",fontSize:50,fontFamily:fontName,fill:"#d43f3f",align:"center",stroke:"#ffabb9",strokeThickness:3});txt.visible=!1,this._effectsCont.addChild(txt),this.minusElements.push(txt)}},showMessage:function(obj){var _this=this,str=obj.str,type=obj.type,heroX=this.Model.X[this.Model.heroIndex]-this.focus,heroY=this.Model.Y[this.Model.heroIndex],p=this._perspectiveProjection(this.Model.X[this.Model.heroIndex]+1,heroY+1,0,heroX,heroY),x=p[0],y=p[1];if(1==type||-1==type){if(1==type){for(i=0;i<this.plusElements.length&&0!=this.plusElements[i].visible;i++);txt=this.plusElements[i]}if(-1==type){for(var i=0;i<this.minusElements.length&&0!=this.minusElements[i].visible;i++);var txt=this.minusElements[i]}if(!txt)return;if(txt.visible=!0,txt.x=x+50,txt.y=y-100,txt.text=""+str,$j(txt).animate({y:-100},{duration:1500,easing:"swing",complete:function(){txt.visible=!1}}),"+ 20 сек"==str&&(this._effectsToDraw.push({id:"effStars",atPoint:null,linkToIndex:this.Model.heroIndex,linkToAsix:"",offset:{X:-.3,Y:0,Z:4},liveTime:48,start:!0}),this._showNewCharHint=!0,$j("#levelui").find("#newchar").show(),setTimeout(function(){_this._showNewCharHint=!1,$j("#levelui").find("#newchar").hide()},2e3),window.sounds.play("new-look")),-1==type){var s=100,t=1e3*this.Model.heroBumpImmortalTime/60-400,sp=this._findResource(this.Model.heroCurrentSkin);null!=sp&&this.blinkSprite(sp,s,t),null!=(sp=this._findResource(this.Model.heroCurrentSkin+"_R"))&&this.blinkSprite(sp,s,t),null!=(sp=this._findResource(this.Model.heroCurrentSkin+"_L"))&&this.blinkSprite(sp,s,t),null!=(sp=this._findResource(this.Model.heroCurrentSkin+"_J"))&&this.blinkSprite(sp,s,t)}}2==type&&this._effectsToDraw.push({id:"takeB",atPoint:null,linkToIndex:this.Model.heroIndex,linkToAsix:"Y",offset:{X:1,Y:0,Z:0},liveTime:60,start:!0}),3==type&&this._effectsToDraw.push({id:"takeT",atPoint:null,linkToIndex:this.Model.heroIndex,linkToAsix:"Y",offset:{X:1,Y:0,Z:0},liveTime:60,start:!0}),4==type&&this._effectsToDraw.push({id:"takeP1",atPoint:null,linkToIndex:this.Model.heroIndex,linkToAsix:"Y",offset:{X:1,Y:0,Z:0},liveTime:60,start:!0}),5==type&&this._effectsToDraw.push({id:"takeP2",atPoint:null,linkToIndex:this.Model.heroIndex,linkToAsix:"Y",offset:{X:1,Y:0,Z:0},liveTime:60,start:!0}),6==type&&this._effectsToDraw.push({id:"takeP3",atPoint:null,linkToIndex:this.Model.heroIndex,linkToAsix:"Y",offset:{X:1,Y:0,Z:0},liveTime:60,start:!0}),7==type&&this._effectsToDraw.push({id:"takeP4",atPoint:null,linkToIndex:this.Model.heroIndex,linkToAsix:"Y",offset:{X:1,Y:0,Z:0},liveTime:60,start:!0})},_messagesCount:0,_checkMessagesToShow:function(){if(this.Model.isStarted&&!(++this._messagesCount<5)&&(this._messagesCount=0,this.Model.messages.length>0)){var obj=this.Model.messages.shift();this.showMessage(obj)}},_showNewCharHint:!1,_newChatHintPos:function(heroX,heroY){if(this._showNewCharHint){var p=this._perspectiveProjection(this.Model.X[this.Model.heroIndex]+1,heroY+.5,0,heroX,heroY);$j("#levelui").find("#newchar").css({left:p[0]+"px",top:"35%"})}},_cameraUpdate:function(){},_setupRoadPartDebug:function(){for(var i=0;i<9;i++)for(var j=0;j<5;j++){var txt=new PIXI.Text("part "+(i+1),{fontWeight:"bold",fontSize:60,fontFamily:"Arial",fill:"#000000",alpha:.5,align:"center",stroke:"#ffffff",strokeThickness:6});txt.layerSprite=this._resourceCont,txt.visible=!1,this._resourcesSprites.push(txt),this._resourcesTypeIds.push("rp"+(i+1)),this._resourcesNames.push("rp"+(i+1))}}}),ViewLevel3dMob=Class.create(ViewLevel3d,{initialize:function(Model){this.Model=Model,this.viewWidth=320,this.viewHeight=480,this._assetsPath="assets/mob/",this.init(),this._drawElementZoom=1,this.viewRadius=80,this.cameraZ=5.5,this.cameraYzoom=5.5,this.cameraXzoom=11,this.focus=10,isMobile&&isTablet&&(this.cameraXzoom=12,this.focus=3.8,this.cameraZ=4.5)}}),ControllerLevel=Class.create({initialize:function(Model,View){this.Model=Model,this.View=View,this._setupKeyboardInput()},Model:null,View:null,_levelNum:0,start:function(levelNum){this.Model.restart(levelNum-1),this.View.initGraphics(),this.View.startDraw(),this._levelNum=levelNum,window.sounds.play("gyroscooter",!0),isMobile&&(sounds.muted?(sounds.unmuteAll(),sounds.muteAll()):(sounds.muteAll(),sounds.unmuteAll()))},restart:function(){this.start(this._levelNum)},pause:function(stopOnlyModel){this.Model.isStarted=!1,1==stopOnlyModel||this.View.stopDraw(),window.sounds.pause("gyroscooter")},rezume:function(){this.Model.isStarted=!0,this.View.startDraw(),window.sounds.play("gyroscooter",!0)},_setupKeyboardInput:function(){function doKeyDown(e){68!=e.keyCode&&39!=e.keyCode||_this.Model.heroTurnRight(),65!=e.keyCode&&37!=e.keyCode||_this.Model.heroTurnLeft(),87!=e.keyCode&&38!=e.keyCode&&32!=e.keyCode||_this.Model.heroJump(),[38,32].indexOf(e.keyCode)>-1&&e.preventDefault()}function doKeyUp(e){87!=e.keyCode&&_this.Model.heroStopMove()}function touchStart(e){if(0!=_this.Model.isStarted){e.preventDefault();var xPos=e.touches[0].clientX,yPos=e.touches[0].clientY;startX=xPos,startY=yPos,startT=_this.Model.time,wasMove=!1}}function touchMove(e){if(0!=_this.Model.isStarted){e.preventDefault();var xPos=e.touches[0].clientX,yPos=e.touches[0].clientY;delX=xPos-startX,delY=yPos-startY,delT=_this.Model.time-startT,wasMove=!0}}function touchEnd(e){0!=_this.Model.isStarted&&(e.preventDefault(),wasMove?delX>touchDelMin?_this.Model.heroTurnRight():delX<-touchDelMin?_this.Model.heroTurnLeft():delY<-touchDelMin&&_this.Model.heroJump():_this.Model.heroJump())}var _this=this;if(isMobile){var canvas=document.getElementById("leveltouch");canvas.addEventListener("touchstart",touchStart,!1),canvas.addEventListener("touchmove",touchMove,!1),canvas.addEventListener("touchend",touchEnd,!1);var startX,startY,startT,delX,delY,delT,touchDelMin=50,wasMove=!1}else{document.addEventListener("keydown",doKeyDown,!1),document.addEventListener("keyup",doKeyUp,!1)}}}),GameModel=Class.create({initialize:function(LC,quizModel,ajax){this._LC=LC,this._aj=ajax,this._aj._GM=this;var _this=this;this._LC.Model.callFinish=function(){_this.levelFinished()},this._quizModel=quizModel,this._quizModel.onClosed=function(){_this.endQuiz()}},timeStampInMs:null,rulesAccepted:!1,prodSeeAccepted:!1,state:null,onChange:null,player:null,score:0,level:0,init:function(){this.player={mypos:"...",bestlevel1:{levelpoints:"...",quizpoints:"..."},bestlevel2:{levelpoints:"...",quizpoints:"..."},bestlevel3:{levelpoints:"...",quizpoints:"..."}},this.score=this.player.score,this.state="load",this._listenLoading(),null!=this.onChange&&this.onChange()},goHome:function(){this.state="home",this.level=0,this._LC.pause(),this._get(),null!=this.onChange&&this.onChange()},playNextLevel:function(){this.rulesAccepted&&this.prodSeeAccepted&&(this.state="level",this.level+=1,this._LC.start(this.level),this._quizModel.refresh(),null!=this.onChange&&this.onChange(),window.sounds.pause("menu"),window.sounds.play("loc"+this.level+"_theme",!0),this.timeStampInMs=window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now(),window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"pageview",eventLabel:"location"+this.level}),window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"start game loc"+this.level,eventLabel:"location"+this.level}))},replayLevel:function(){this.level-=1,this.playNextLevel()},levelFinished:function(){var _this=this;this.state="finish",this._save(),null!=_this.onChange&&_this.onChange(),window.sounds.play("win-game"),window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"finish loc"+this.level,eventLabel:"resultgame",eventValue:"{"+this._LC.Model.coinsFounded+"}"})},isNewRecord:function(){return this.getLevelScore()>this.getLevelScoreBest()},_writeRecord:function(){this.player.best[this.level-1].levelpoints=this._LC.Model.coinsFounded,this.player.best[this.level-1].quizpoints=this._quizModel.bonusePoints},getLevelScore:function(){return this._LC.Model.coinsFounded+this._quizModel.bonusePoints},getLevelScoreBest:function(){return this.player["bestlevel"+this.level].levelpoints+this.player["bestlevel"+this.level].quizpoints},levelPause:function(){"level"==this.state&&(this.state="pause",this._LC.pause(),null!=this.onChange&&this.onChange(),window.sounds.pauseAll())},levelRezume:function(){"pause"==this.state&&(this.state="level",this._LC.rezume(),null!=this.onChange&&this.onChange(),window.sounds.rezumeAll())},_quizModel:null,startQuiz:function(){this.state="quiz";for(var factsToAsk=[],i=0;i<this._LC.Model.productFounded;i++)factsToAsk.push(this._LC.Model.productInfo[i]);this._quizModel.start(factsToAsk),null!=this.onChange&&this.onChange()},endQuiz:function(){this.state="finish",this._save(),null!=this.onChange&&this.onChange()},_aj:null,_save:function(){var _this=this,rezult={uid:this.timeStampInMs,levelid:this.level,points:{levelpoints:this._LC.Model.coinsFounded,quizpoints:this._quizModel.bonusePoints},productcontacts:this._LC.Model.productFounded,quizstats:{questions:this._quizModel.factsToAsk,answers:this._quizModel.userAnswers}};this._aj.saveLevelRezult(rezult,function(){_this._get()},this._LC.Model.record.toString())},_get:function(){var _this=this;_this._aj.getPlayerProgress(function(data){_this.player=data,console.log("player = ",JSON.stringify(_this.player)),null!=_this.onChange&&_this.onChange()})},_LC:null,_listenLoading:function(){function updateBar(){var p=(window.sounds.getLoadingPercent()+_this._LC.View.getLoadingPercent())/2;p=Math.round(p),$j("#game_cont").find("#bar_percents").html(p+"%")}function onComplete(){3==++contentLoaded&&(_this.goHome(),_this.updateBar=null,_this.callSetupSounds(),window.destroyLoaderAnimation())}var _this=this;window.sounds.onloadProgress=updateBar,this._LC.View.onloadProgress=updateBar,window.sounds.onloadComplete=onComplete,this._LC.View.onloadComplete=onComplete,window.onAnimationStepComplete=onComplete;var contentLoaded=0},TestQuiz:function(delay){var _this=this;setTimeout(function(){_this.state="quiz",_this._quizModel.start(["fact1","fact3","fact2"]),null!=_this.onChange&&_this.onChange()},delay)}}),GameView=Class.create({initialize:function(M,LC){window.isMobile&&(this.mob=""),this._M=M,this._LC=LC,this.init()},init:function(){this._setupHandlers(),this._setupPopUpPositionAndSize(),this._setupInstructions(),this.update()},update:function(){this.hideAllStates(),"load"==this._M.state&&($j("#loader").fadeIn(250),$j("#pages_cont").show()),"home"==this._M.state&&($j("#home").fadeIn(250),$j("#pages_cont").show()),"level"==this._M.state&&($j("#levelui").fadeIn(250),$j("#levelui").find("#hud1").removeClass("hudfon1").removeClass("hudfon2").removeClass("hudfon3").addClass("hudfon"+this._M.level)),"pause"==this._M.state&&($j("#pause_popup").fadeIn(250),$j("#popups_cont").show()),"finish"==this._M.state&&($j("#finish_page").fadeIn(250),$j("#pages_cont").show(),this._updateFinishLevelInfo(),window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"pageview",eventLabel:"resultgame"})),"quiz"==this._M.state&&($j("#popups_cont").show(),$j("#finish_page").show(),$j("#pages_cont").show(),window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"pageview",eventLabel:"quizpage"})),this._resize(),this._updateSoundButtons()},hideAllStates:function(){$j("#pages_cont").hide(),$j("#loader").hide(),$j("#home").hide(),$j("#choose_level").hide(),$j("#choose_level_mob").hide(),$j("#finish_page").hide(),$j("#levelui").hide(),$j("#popups_cont").hide(),this.hideAllPopups()},hideAllPopups:function(){$j("#pause_popup").hide(),$j("#info_popup").hide(),$j("#instructions_popup").hide(),$j("#invite_popup").hide(),$j("#slide_popups_cont").hide(),$j("#phone_popup").hide(),$j("#count_popup").hide()},callHome:null,callStartLevel:null,callReplayLevel:null,callPause:null,callRezume:null,callQuiz:null,infoPopupOn:!1,showInfo:function(levelIndex,infoId){var _this=this;$j("#info_popup").find("#picture").attr("src","assets/ui/info"+infoId+".jpg"),setTimeout(function(){$j("#popups_cont").show(),$j("#info_popup").fadeIn(250),_this.infoPopupOn=!0},800),this._LC.pause(!0),isMobile&&$j("#info_popup").find("#keyboard_hint").hide(),window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"popup fact"+infoId,eventLabel:"location"+this._M.level+"}",eventValue:"{"+this._LC.Model.coinsFounded})},setupSounds:function(){var _this=this;this._setupSoundButton($j("#levelui").find("#sound"),0),this._setupSoundButton($j("#home").find("#sound"),1),isMobile?($j("#sound_enable_popup").show(),$j("#sound_enable_popup").find("#snd_yes").on({mousedown:function(){_this._unmuteAlltoSharedObj(),_this._updateSoundButtons(),window.sounds.pauseAll(),window.sounds.play("menu",!0),$j("#sound_enable_popup").hide()}}),$j("#sound_enable_popup").find("#snd_no").on({mousedown:function(){_this._muteAlltoSharedObj(),_this._updateSoundButtons(),window.sounds.pauseAll(),window.sounds.play("menu",!0),$j("#sound_enable_popup").hide()}})):(window.sounds.pauseAll(),window.sounds.play("menu",!0))},mob:"",_M:null,_LC:null,_isInstructionShowed:!1,_setupHandlers:function(){function showChooseLevels(){$j("#home").hide(),$j("#pages_cont").show(),$j("#choose_level"+_this.mob).fadeIn(250),_this._updateLevelsInfo()}function chooseLevel(num){_this._M.level=num-1,null!=_this.callStartLevel&&_this.callStartLevel(),showInstructions(!1,"level")}function showInstructions(force,page){force||!_this._isInstructionShowed?(_this._LC.pause(!0),_refreshInstruction(),$j("#levelui").hide(),$j("#instructions_popup").fadeIn(550),$j("#popups_cont").show(),"home"==page?($j("#instructions_popup").find("#skip").hide(),isMobile||$j("#instructions_popup").removeClass("g_infofon").addClass("g_slider_fon")):($j("#instructions_popup").find("#skip").show(),isMobile||$j("#instructions_popup").addClass("g_infofon").removeClass("g_slider_fon")),isMobile&&$j("#instructions_popup").scrollTop(0)):showPhone()}function goFromInstructions(){$j("#levelui").show(),$j("#instructions_popup").hide(),$j("#popups_cont").hide(),_this._LC.rezume(),0==_this._isInstructionShowed&&showPhone(),_this._isInstructionShowed=!0,_refreshInstruction(),instructionsFromLevelHud=!1}function showPhone(){_this._LC.pause(!0);var id=_this._M.level;$j("#phone_popup").find("#text1").hide(),$j("#phone_popup").find("#text2").hide(),$j("#phone_popup").find("#text3").hide(),$j("#phone_popup").find("#text"+id).show(),$j("#phone_popup").find("#picture").attr("src","assets/ui/phone"+id+".png"),$j("#phone_popup").show(),$j("#popups_cont").show(),$j("#phone_popup").find("#picture").css({top:"600px"}),$j("#phone_popup").find("#picture").animate({top:"-30px"},1e3)}function startTimer(){function countTimer(){t>0?($j("#count_popup").find("#timercount").find("p").html(t),t--,setTimeout(countTimer,1e3)):($j("#count_popup").hide(),$j("#popups_cont").hide(),_this._LC.rezume())}var t=3;_this._LC.pause(),$j("#count_popup").show(),$j("#popups_cont").show(),countTimer()}function doKeyUp(e){"13"==e.keyCode&&hideInfo()}function hideInfo(){0!=_this.infoPopupOn&&($j("#popups_cont").hide(),$j("#info_popup").hide(),_this._LC.pause(),_this._LC.rezume(),_this.infoPopupOn=!1,window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"popup fact close",eventLabel:"location"+_this._M.level+"}",eventValue:"{"+_this._LC.Model.coinsFounded}))}function countChecked(){_this._M.rulesAccepted&&_this._M.prodSeeAccepted?_this._M.rulesAccepted=_this._M.prodSeeAccepted=!1:_this._M.rulesAccepted=_this._M.prodSeeAccepted=!0,_this._M.rulesAccepted&&_this._M.prodSeeAccepted?$j("#home").find("#checkrules").addClass("g_check_on").removeClass("g_check_off").removeClass("g_check_off_red"):$j("#home").find("#checkrules").addClass("g_check_off").removeClass("g_check_on").removeClass("g_check_off_red"),$j("#home").find("#checkrules").finish(),null!=redAlertInterval&&clearInterval(redAlertInterval)}function checkRulesRedAlert(){function dofadeAnim(){$j("#home").find("#checkrules").fadeTo(fadeTime,.5).fadeTo(fadeTime,1)}$j("#home").find("#checkrules").addClass("g_check_off_red");var fadeTime=1e3;null!=redAlertInterval&&clearInterval(redAlertInterval),redAlertInterval=setInterval(dofadeAnim,2*fadeTime),dofadeAnim()}var _this=this;$j("#home").find("#play").on({mousedown:function(){_this._M.rulesAccepted&&_this._M.prodSeeAccepted?showChooseLevels():checkRulesRedAlert()}}),$j("#home").find("#sound_turn").on({mousedown:function(){window.sounds.pauseAll(),window.sounds.play("menu",!0)}}),$j("#home").find("#invite").on({mousedown:function(){$j("#invite_popup").fadeIn(250),$j("#slide_popups_cont").show(),window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"pageview",eventLabel:"invitefriend"})}}),$j("#invite_popup").find("#back").on({mousedown:function(){$j("#invite_popup").hide(),$j("#slide_popups_cont").hide()}}),$j("#home").find("#rules").on({mousedown:function(){showInstructions(!0,"home")}}),$j("#choose_level"+_this.mob).find("#back").on({mousedown:function(){null!=_this.callHome&&_this.callHome()}}),$j("#choose_level"+_this.mob).find("#level1").find("#start").on({mousedown:function(){chooseLevel(1)}}),$j("#choose_level"+_this.mob).find("#level2").find("#start").on({mousedown:function(){chooseLevel(2)}}),$j("#choose_level"+_this.mob).find("#level3").find("#start").on({mousedown:function(){chooseLevel(3)}});var instructionsFromLevelHud=!1;$j("#levelui").find("#info").on({mousedown:function(){instructionsFromLevelHud=!0,showInstructions(!0,"level")}}),$j("#instructions_popup").find("#play").on({mousedown:goFromInstructions}),$j("#instructions_popup").find("#skip").on({mousedown:goFromInstructions}),$j("#instructions_popup").find("#close").on({mousedown:function(){$j("#instructions_popup").hide(),$j("#popups_cont").hide(),instructionsFromLevelHud=!1}}),$j("#instructions_popup").find("#back").on({mousedown:function(){"level"==_this._M.state?instructionsFromLevelHud?goFromInstructions():(null!=_this.callHome&&_this.callHome(),showChooseLevels(),window.sounds.pauseAll(),window.sounds.play("menu",!0)):($j("#instructions_popup").hide(),$j("#popups_cont").hide()),instructionsFromLevelHud=!1}}),$j("#phone_popup").find("#play").on({mousedown:function(){startTimer(),$j("#phone_popup").hide()}}),$j("#levelui").find("#pause").on({mousedown:function(){null!=_this.callPause&&_this.callPause()}}),$j(document).keyup(function(e){27==(e.keyCode?e.keyCode:e.which)&&null!=_this.callPause&&_this.callPause()}),$j("#pause_popup").find("#rezume").on({mousedown:function(){null!=_this.callRezume&&_this.callRezume()}}),$j("#pause_popup").find("#home").on({mousedown:function(){null!=_this.callHome&&_this.callHome(),window.sounds.pauseAll(),window.sounds.play("menu",!0)}}),$j("#info_popup").find("#rezume").on({click:function(){hideInfo()}}),document.addEventListener("keyup",doKeyUp,!0),$j("#finish_page").find("#replay").on({click:function(){null!=_this.callReplayLevel&&_this.callReplayLevel(),setTimeout(startTimer,100)}}),$j("#finish_page").find("#test").on({click:function(){window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"receive additional points",eventLabel:"resultgame"}),null!=_this.callQuiz&&_this.callQuiz()}}),$j("#finish_page").find("#home").on({click:function(){null!=_this.callHome&&_this.callHome(),window.sounds.pauseAll(),window.sounds.play("menu",!0),window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"finish and go to main page",eventLabel:"resultgame"})}}),$j("#popups_cont").find("#p_close").on({click:function(){$j("#popups_cont").hide(),_this.hideAllPopups()}}),$j("#home").find("#checkrules").on({click:countChecked}),countChecked();var redAlertInterval=null},_setupPopUpPositionAndSize:function(){window.addEventListener("resize",this._resize),this._resize()},_resize:function(){var mobileScale=1;window.isMobile&&(mobileScale=1);var wWidth=587,wHeight=430,canvasX=$j("#renderCanvas")[0].getBoundingClientRect().left+$j(window).scrollLeft(),canvasY=$j("#renderCanvas")[0].getBoundingClientRect().top+$j(window).scrollTop(),canvasW=$j("#renderCanvas")[0].getBoundingClientRect().width,canvasH=$j("#renderCanvas")[0].getBoundingClientRect().height;isMobile&&_isHorizontal&&!isTablet&&(canvasW=100,canvasH=100),consoleOn&&console.log("_resize "+canvasW+" x "+canvasH),wWidth*mobileScale>canvasW&&(wWidth=canvasW/mobileScale),wHeight*mobileScale>canvasH&&(wHeight=canvasH/mobileScale);$j("#popups_cont").css({width:canvasW,height:canvasH}),$j("#popups_cont").css({top:canvasY,left:canvasX}),$j("#slide_popups_cont").css({width:canvasW,height:canvasH}),$j("#slide_popups_cont").css({top:canvasY,left:canvasX}),$j("#pages_cont").css({width:canvasW,height:canvasH}),$j("#pages_cont").css({top:canvasY,left:canvasX}),$j("#levelui").css({width:canvasW,height:canvasH}),$j("#levelui").css({top:canvasY,left:canvasX}),$j("#game_system_alerts").css({width:canvasW,height:canvasH}),$j("#game_system_alerts").css({top:canvasY,left:canvasX})},_setupInstructions:function(){function refreshInstruction(prerender){function _render(){consoleOn&&console.log("prerender instructions"),_cc++,showNext(),_cc<3?setTimeout(_render,500):(_InsCount=0,showNext())}if(_InsCount=0,showNext(),_jQInsObj.find("#next").show(),_jQInsObj.find("#skip").show(),_jQInsObj.find("#play").hide(),_jQInsObj.find("#close").hide(),1==prerender){var _cc=0;_render()}}function showNext(){_InsCount++,_jQInsObj.find("#picture").attr("src",_InsData[_InsCount-1].img),4==_InsCount?(_jQInsObj.find("#invite").show(),_jQInsObj.find("#nextvioletmix").show()):(_jQInsObj.find("#invite").hide(),_jQInsObj.find("#nextvioletmix").hide()),_InsCount>=_InsData.length&&(_jQInsObj.find("#next").hide(),_jQInsObj.find("#skip").hide(),"level"==_this._M.state?_jQInsObj.find("#play").show():_jQInsObj.find("#close").show()),isMobile&&($j("#instructions_popup").find("#ins_curr").html(_InsCount),$j("#instructions_popup").find("#ins_total").html("/4"),$j("#instructions_popup").scrollTop(0),1==_InsCount?$j(".er_howto_buttons").css({top:"530px"}):$j(".er_howto_buttons").css({top:"630px"})),$j("#instructions_popup").find(".er_instrucitons_cont").hide(),$j("#instructions_popup").find(".er_instrucitons_cont").fadeIn(250)}var _this=this,_InsData=[{img:"assets/ui/instruction1.png"},{img:"assets/ui/instruction2.png"},{img:"assets/ui/instruction3.png"},{img:"assets/ui/instruction4.png"}];isMobile&&(_InsData=[{img:"assets/ui/mob/howto1.png"},{img:"assets/ui/mob/howto2.png"},{img:"assets/ui/mob/howto3.png"},{img:"assets/ui/mob/howto4.png"}],$j("#instructions_popup").find(".er_instructions_current").show());var _jQInsObj=$j("#instructions_popup");_jQInsObj.find("#next").on("click",showNext);var _InsCount;_refreshInstruction=refreshInstruction},_updateLevelsInfo:function(){for(var i=0;i<3;i++)$j("#choose_level"+this.mob).find("#level"+(i+1)).find("#best").html('<img src="assets/ui/levels_star.png"> '+(this._M.player["bestlevel"+(i+1)].levelpoints+this._M.player["bestlevel"+(i+1)].quizpoints)+" баллов")},_updateFinishLevelInfo:function(){$j("#finish_page").find("#score").html("Результат уровня: "+this._LC.Model.coinsFounded+" баллов"),$j("#finish_page").find("#text1").hide(),$j("#finish_page").find("#text2").hide(),$j("#finish_page").find("#text3").hide(),$j("#finish_page").find("#text_q").hide(),$j("#finish_page").find("#text"+this._M.level).show(),$j("#finish_page").addClass("finish_page_fon"+this._M.level),this._M._quizModel.quizFinished?($j("#finish_page").find("#text"+this._M.level).hide(),$j("#finish_page").find("#bonuse").show(),$j("#finish_page").find("#bonuse").html("Дополнительных баллов: "+this._M._quizModel.bonusePoints+" баллов"),$j("#finish_page").find("#text_q").show(),$j("#finish_page").find("#test").hide()):($j("#finish_page").find("#test").show(),$j("#finish_page").find("#bonuse").hide()),$j("#finish_page").find("#best").html("Лучший результат уровня: "+this._M.getLevelScoreBest()+" баллов"),$j("#finish_page").find("#rate").html("Позиция в рейтинге: "+this._M.player.mypos)},_soundsStyles:["snd","g_soundM"],_setupSoundButton:function(_button,styleIndex){var _this=this;this._updateSoundButtonsState(_button,styleIndex);"localStorage"in window&&window.localStorage;_button.on({mousedown:function(){window.sounds.muted?_this._unmuteAlltoSharedObj():_this._muteAlltoSharedObj(),_this._updateSoundButtonsState(_button,styleIndex)}})},_unmuteAlltoSharedObj:function(){var canUseLocalStorage="localStorage"in window&&null!==window.localStorage;sounds.unmuteAll(),canUseLocalStorage&&localStorage.setItem("nextlookgame.soundOn",!0)},_muteAlltoSharedObj:function(){var canUseLocalStorage="localStorage"in window&&null!==window.localStorage;sounds.muteAll(),canUseLocalStorage&&localStorage.setItem("nextlookgame.soundOn",!1)},_updateSoundButtons:function(){this._updateSoundButtonsState($j("#levelui").find("#sound"),0),this._updateSoundButtonsState($j("#home").find("#sound"),1)},_updateSoundButtonsState:function(_button,styleIndex){var _this=this;if("localStorage"in window&&null!==window.localStorage){var soundOn=localStorage.getItem("nextlookgame.soundOn");null!=soundOn?"true"==soundOn?(sounds.unmuteAll(),_button.addClass(_this._soundsStyles[styleIndex]+"_on").removeClass(_this._soundsStyles[styleIndex]+"_off")):(sounds.muteAll(),_button.addClass(_this._soundsStyles[styleIndex]+"_off").removeClass(_this._soundsStyles[styleIndex]+"_on")):localStorage.setItem("nextlookgame.soundOn",!0)}}}),GameController=Class.create({initialize:function(Model,View){Model.onChange=function(){View.update()},Model.callSetupSounds=function(){View.setupSounds()},View.callStartLevel=function(){Model.playNextLevel()},View.callReplayLevel=function(){Model.replayLevel()},View.callPause=function(){Model.levelPause()},View.callRezume=function(){Model.levelRezume()},View.callHome=function(){Model.goHome()},View.callQuiz=function(){Model.startQuiz()}}}),QuizModel=Class.create({initialize:function(){this.init()},init:function(){this.state="hidden",this.refresh(),null!=this.onUpdate&&this.onUpdate()},quizFinished:!1,state:null,onUpdate:null,onTimerUpdate:null,currentQuestionIndex:null,factsToAsk:null,pointsForTrueAnswer:50,userAnswers:null,bonusePoints:0,trueAnswersNum:0,refresh:function(){this.quizFinished=!1,this.factsToAsk=[],this.userAnswers=[],this.bonusePoints=0,this.trueAnswersNum=0,this.currentQuestionIndex=-1},_factsIdsLeft:[],_factsIdsLastThree:[],start:function(factsFounded){this.state="intro";var factsIds=["fact1","fact2","fact3","fact4","fact5","fact6","fact7","fact8","fact9","fact10"];if(this._factsIdsLeft.length<3){this._factsIdsLeft=[].concat(factsIds);for(var lt=0;lt<this._factsIdsLastThree.length;lt++){var _index=this._factsIdsLeft.indexOf(this._factsIdsLastThree[lt]);this._factsIdsLeft.splice(_index,1)}}this.factsToAsk=[],this._factsIdsLastThree=[];var randomIds=this._randomNumbers(3,0,this._factsIdsLeft.length-1);window.consoleOn&&console.log("randomIds = "+randomIds);for(var i=0;i<randomIds.length;i++)this.factsToAsk.push(""+this._factsIdsLeft[randomIds[i]]),this._factsIdsLastThree.push(""+this._factsIdsLeft[randomIds[i]]),this._factsIdsLeft[randomIds[i]]=null;window.consoleOn&&console.log("q = "+this.factsToAsk);for(var l=0;l<3;l++){var nullIndex=this._factsIdsLeft.indexOf(null);this._factsIdsLeft.splice(nullIndex,1)}window.consoleOn&&console.log("q left = "+this._factsIdsLeft),null!=this.onUpdate&&this.onUpdate(),this.nextQuestion()},nextQuestion:function(){this.state="question",++this.currentQuestionIndex+1>this.factsToAsk.length&&(window.consoleOn&&console.log("quiz end. bonus = "+this.bonusePoints),this.quizFinished=!0,this.close()),null!=this.onUpdate&&this.onUpdate()},getCurrentFactJson:function(){return this.facts[this.factsToAsk[this.currentQuestionIndex]]},tryAnswer:function(index){var _this=this;window.consoleOn&&console.log("answer = "+(index+1)),index+1==this.facts[this.factsToAsk[this.currentQuestionIndex]].correct?this.userAnswers.push(!0):this.userAnswers.push(!1),window.consoleOn&&console.log(this.userAnswers),this.trueAnswersNum=this.userAnswers.filter(function(value){return 1==value}).length,this.bonusePoints=this.trueAnswersNum*this.pointsForTrueAnswer,null!=this.timer&&clearInterval(this.timer),setTimeout(function(){_this.nextQuestion()},1500);var res=this.userAnswers[this.userAnswers.length-1];return this._save_dataLayer(res,this.userAnswers.length,this.getCurrentFactJson().id),res},rezult:function(){this.state="rezult",null!=this.onUpdate&&this.onUpdate(),null!=this.timer&&clearInterval(this.timer)},onClosed:null,close:function(){this.state="hidden",null!=this.onClosed&&this.onClosed(),null!=this.onUpdate&&this.onUpdate()},time:0,timer:null,startTimer:function(){this.time=15;var _this=this;null!=this.timer&&clearInterval(this.timer),this.timer=setInterval(function(){window.consoleOn&&console.log("time = "+_this.time),--_this.time<=0&&(clearInterval(_this.timer),_this.nextQuestion()),null!=_this.onTimerUpdate&&_this.onTimerUpdate()},1e3)},facts:{fact1:{id:"question1",texttoshow:"",icon:"assets/ui/quiz_icon_filter.png",texttoask:"Каким эффектом НЕ обладает###угольный фильтр RECESSED в Next Violet Mix?",answer1:"Лучше сохраняет форму",answer2:"Меньше намокает при  курении",answer3:"Сокращает сеанс курения",answer4:"Обеспечивает мягкий вкус",correct:3},fact2:{id:"question2",texttoshow:"",icon:"assets/ui/quiz_icon_diamond.png",texttoask:"В технологии Diamond Cut###используется:",answer1:"Пар, которым обрабатывают табак",answer2:"Лезвия с алмазной обработкой, которые нарезают табачный лист особенно тонко",answer3:"Алмазы, которыми обрабатывают табачные листы",answer4:"",correct:2},fact3:{id:"question3",texttoshow:"",icon:"assets/ui/quiz_icon_noicon.png",texttoask:"Какое содержание смолы###в новом Next Violet Mix?",answer1:"8 мг/сиг",answer2:"5 мг/сиг",answer3:"6 мг/сиг",answer4:"10 мг/сиг",correct:2},fact4:{id:"question4",texttoshow:"",icon:"assets/ui/quiz_icon_noicon.png",texttoask:"Максимальная розничная цена###за одну пачку Next Violet Mix:",answer1:"82 руб.",answer2:"90 руб.",answer3:"87 руб.",answer4:"100 руб.",correct:1},fact5:{id:"question5",texttoshow:"",icon:"assets/ui/quiz_icon_pachka.png",texttoask:"Какой формат сигарет###используется в новом NEXT Violet Mix?",answer1:"Super Slims",answer2:"Compact",answer3:"Ultra light",answer4:"King size super slims",correct:1},fact6:{id:"question6",texttoshow:"",icon:"assets/ui/quiz_icon_filter_violetmix.png",texttoask:"Как называется новая разновидность###сигарет NEXT с Капсулой?",answer1:"Violet Mix",answer2:"Capsule Mix",answer3:"Violet Capsule",answer4:"",correct:1},fact7:{id:"question7",texttoshow:"",icon:"assets/ui/quiz_icon_filter_violetmix.png",texttoask:"Какой тип фильтра###используется в NEXT VIOLET MIX?:",answer1:"Фильтр с табачной секцией",answer2:"Фильтр с микрогранулами",answer3:"Фильтр-мундштук с капсулой",answer4:"",correct:3},fact8:{id:"question8",texttoshow:"",icon:"assets/ui/quiz_icon_filter_violetmix.png",texttoask:"Что нужно сделать, чтобы###активировать капсулу и изменить вкус?",answer1:"Ничего, сигарета полностью ароматизирована.",answer2:"Докурить сигарету до определенного места",answer3:"Активировать капсулу нажатием на фильтр",answer4:"",correct:3},fact9:{id:"question9",texttoshow:"",icon:"assets/ui/quiz_icon_diamond.png",texttoask:"С помощью какой технологии табак###в сигаретах NEXT* нарезается особенно тонко?",textspecs:"*Применимо для разновидностей Next Violet Mix, Violet, Rose и Menthol. Виолет. Микс. Роуз. Ментол",answer1:"Ultra cut",answer2:"Diamond cut",answer3:"Laser saw",answer4:"Pure Diamond",correct:2},fact10:{id:"question10",texttoshow:"",icon:"assets/ui/quiz_icon_filter_violetmix.png",texttoask:"Капсула с каким вкусом###используется в новом Next Violet MIX?",answer1:"Вкус лесных ягод",answer2:"Вкус черники",answer3:"Вкус табака",answer4:"Вкус мяты",correct:1}},_save_dataLayer:function(res,questionNum,questionId){window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"quiz answer "+questionNum+" question",eventLabel:""+questionId}),res?window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"quiz answer "+questionNum+" question correct",eventLabel:""+questionId}):window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"quiz answer "+questionNum+" question uncorrect",eventLabel:""+questionId})},_randomNumbers:function(num,from,to){if(num>to-from+1)return window.consoleOn&&console.log("ERROR _randomNumbers : small numbers range"),[];for(var arr=[],___whilecount=0;arr.length<num;){if(++___whilecount>999)return window.consoleOn&&console.log("ERROR while > 999"),[];var randomnumber=from+Math.round(Math.random()*(to-from));arr.indexOf(randomnumber)>-1||(arr[arr.length]=randomnumber)}return arr}}),QuizView=Class.create({initialize:function(Model){this._M=Model,this.init()},init:function(){this._setupHandlers(),this.update()},_M:null,update:function(){this.hideAllStates(),"hidden"==this._M.state&&$j("#popups_cont").hide(),"intro"==this._M.state&&$j("#quiz_intro_popup").show(),"question"==this._M.state&&($j("#quiz_play_popup").show(),this._drawQuestion()),"rezult"==this._M.state&&($j("#quiz_rezult_popup").show(),$j("#quiz_rezult_popup").find("#trueanswers").html("Правильных ответов: "+this._M.trueAnswersNum),$j("#quiz_rezult_popup").find("#points").html("Заработано дополнительных баллов: "+this._M.bonusePoints)),"alert"==this._M.state&&$j("#quiz_alert_popup").show()},hideAllStates:function(){$j("#quiz_intro_popup").hide(),$j("#quiz_play_popup").hide(),$j("#quiz_rezult_popup").hide(),$j("#quiz_alert_popup").hide()},_setupHandlers:function(){function chooseAnswer(index){_choosedAnswer=_this._answersIds[index],$j("#quiz_play_popup").find("#next").removeClass("button_disabled"),_this._refreshBottons(),_this._choosedAnswerButton=$j("#quiz_play_popup").find("#answer"+(index+1)),_this._choosedAnswerButton.addClass("g_quiz_button_on")}var _this=this;$j("#quiz_intro_popup").find("#play").on({mousedown:function(){_this._M.nextQuestion()}}),$j("#quiz_intro_popup").find("#back").on({mousedown:function(){_this._M.close()}});var _choosedAnswer=null;$j("#quiz_play_popup").find("#next").on({mousedown:function(target){if(null!=_choosedAnswer){_this._M.tryAnswer(_choosedAnswer);_this._choosedAnswerButton.find("#__truefalse").removeClass("g_quiz_true").addClass("g_quiz_false"),_this._choosedAnswerButton.find("#__truefalse").show(),_this._choosedAnswerButton[0]==_this._trueAnswerButton[0]&&(_this._trueAnswerButton.find("#__truefalse").removeClass("g_quiz_false").addClass("g_quiz_true"),_this._trueAnswerButton.find("#__truefalse").show()),$j("#quiz_play_popup").find("#block").show()}}}),$j("#quiz_play_popup").find("#answer1").on({mousedown:function(target){chooseAnswer(0)}}),$j("#quiz_play_popup").find("#answer2").on({mousedown:function(target){chooseAnswer(1)}}),$j("#quiz_play_popup").find("#answer3").on({mousedown:function(target){chooseAnswer(2)}}),$j("#quiz_play_popup").find("#answer4").on({mousedown:function(target){chooseAnswer(3)}}),$j("#quiz_rezult_popup").find("#close").on({mousedown:function(){_this._M.close()}}),$j("#quiz_alert_popup").find("#close").on({mousedown:function(){_this._M.close()}})},_refreshBottons:function(){$j("#quiz_play_popup").find("#answer1").removeClass("g_quiz_button_on"),$j("#quiz_play_popup").find("#answer2").removeClass("g_quiz_button_on"),$j("#quiz_play_popup").find("#answer3").removeClass("g_quiz_button_on"),$j("#quiz_play_popup").find("#answer4").removeClass("g_quiz_button_on")},_answersIds:[],_trueAnswerButton:null,_choosedAnswerButton:null,_drawQuestion:function(){$j("#quiz_play_popup").find("#block").hide(),this._refreshBottons(),$j("#quiz_play_popup").find("#next").addClass("button_disabled");var obj=this._M.getCurrentFactJson();$j("#quiz_play_popup").find("#number").find("h1").html(this._M.currentQuestionIndex+1),$j("#quiz_play_popup").find("#number").find("h2").html("/"+this._M.factsToAsk.length);var text1=obj.texttoask.split("###")[0],text2=obj.texttoask.split("###")[1];$j("#quiz_play_popup").find("#question1").html(text1),$j("#quiz_play_popup").find("#question2").html(text2);for(var answers=[],i=0;i<4;i++)obj["answer"+(i+1)]&&answers.push(obj["answer"+(i+1)]);window.consoleOn&&console.log(answers),this._answersIds=this._randomNumbers(answers.length,0,answers.length-1),window.consoleOn&&console.log(this._answersIds),$j("#quiz_play_popup").find("#answer1").hide(),$j("#quiz_play_popup").find("#answer2").hide(),$j("#quiz_play_popup").find("#answer3").hide(),$j("#quiz_play_popup").find("#answer4").hide();for(var j=0;j<this._answersIds.length;j++)$j("#quiz_play_popup").find("#answer"+(j+1)).show(),$j("#quiz_play_popup").find("#answer"+(j+1)).find("p").html(""+answers[this._answersIds[j]]),Number(obj.correct)==Number(this._answersIds[j]+1)&&(this._trueAnswerButton=$j("#quiz_play_popup").find("#answer"+(j+1))),$j("#quiz_play_popup").find("#answer"+(j+1)).find("#__truefalse").hide();obj.textspecs?$j("#quiz_play_popup").find("#textspecs").html(obj.textspecs):$j("#quiz_play_popup").find("#textspecs").html(""),$j("#quiz_play_popup").find("#quizicon").attr("src",obj.icon)},drawAnswerResult:function(res,button){1==res?$j(button).addClass("buttontrueanswer"):$j(button).addClass("buttonfalseanswer"),$j("#quiz_play_popup").find("#block").show(),$j(button).fadeTo(10,0,function(){$j(button).fadeTo(100,.5,function(){$j(button).fadeTo(10,0,function(){$j(button).fadeTo(250,.8,function(){$j(button).fadeTo(10,0,function(){$j(button).fadeTo(500,1)})})})})})},timerUpdate:function(){$j("#quiz_play_popup").find("#time").html("ВРЕМЯ: "+this._M.time+" сек.")},_randomNumbers:function(num,from,to){if(num>to-from+1)return window.consoleOn&&console.log("ERROR _randomNumbers : small numbers range"),[];for(var arr=[],___whilecount=0;arr.length<num;){if(++___whilecount>999)return window.consoleOn&&console.log("ERROR while > 999"),[];var randomnumber=from+Math.round(Math.random()*(to-from));arr.indexOf(randomnumber)>-1||(arr[arr.length]=randomnumber)}return arr}}),QuizController=Class.create({initialize:function(Model,View){Model.onUpdate=function(){View.update()},Model.onTimerUpdate=function(){View.timerUpdate()},this.init()},init:function(){}}),AjaxContent=Class.create({initialize:function(){this.init()},init:function(){this._setupRate(),this._setupCheckConnection()},saveLevelRezult:function(points,callBack,_record){var _0x1e9d=["RGF0YTog","ClN0YXR1czog","c3VjY2Vzcw==","c2hvd0dpZnQ=","c3RyaW5naWZ5","U0hBMjU2"];!function(_0x137a30,_0x278297){!function(_0x1c3e3b){for(;--_0x1c3e3b;)_0x137a30.push(_0x137a30.shift())}(++_0x278297)}(_0x1e9d,424);var _0xd1e9=function(_0x137a30,_0x278297){var _0xb5dc08=_0x1e9d[_0x137a30-=0];return void 0===_0xd1e9.initialized&&(!function(){var _0x53d63f=Function('return (function () {}.constructor("return this")());')();_0x53d63f.atob||(_0x53d63f.atob=function(_0x517581){for(var _0x3674df,_0x217370,_0x5c0792=String(_0x517581).replace(/=+$/,""),_0x37c456=0,_0x1cdb66=0,_0x46721e="";_0x217370=_0x5c0792.charAt(_0x1cdb66++);~_0x217370&&(_0x3674df=_0x37c456%4?64*_0x3674df+_0x217370:_0x217370,_0x37c456++%4)?_0x46721e+=String.fromCharCode(255&_0x3674df>>(-2*_0x37c456&6)):0)_0x217370="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(_0x217370);return _0x46721e})}(),_0xd1e9.base64DecodeUnicode=function(_0x4ebf42){for(var _0x2c5aa8=atob(_0x4ebf42),_0x3ee3e2=[],_0x1080b8=0,_0x5e148a=_0x2c5aa8.length;_0x1080b8<_0x5e148a;_0x1080b8++)_0x3ee3e2+="%"+("00"+_0x2c5aa8.charCodeAt(_0x1080b8).toString(16)).slice(-2);return decodeURIComponent(_0x3ee3e2)},_0xd1e9.data={},_0xd1e9.initialized=!![]),void 0===_0xd1e9.data[_0x137a30]?(_0xb5dc08=_0xd1e9.base64DecodeUnicode(_0xb5dc08),_0xd1e9.data[_0x137a30]=_0xb5dc08):_0xb5dc08=_0xd1e9.data[_0x137a30],_0xb5dc08},_var1=JSON[_0xd1e9("0x0")](points),_var3=CryptoJS[_0xd1e9("0x1")](_var1+"_ljkhu");$j.post("/nextrun/save-result",{data:points,hash:_var3.toString(),record:_record},function(_0x5b6c8d,_0x10435c){console.log(_0xd1e9("0x2")+JSON[_0xd1e9("0x0")](_0x5b6c8d)+_0xd1e9("0x3")+_0x10435c),_0x10435c===_0xd1e9("0x4")&&callBack(),_0x5b6c8d[_0xd1e9("0x5")]&&_0x5b6c8d.showGift==!![]&&showGiftPopup()})},getPlayerProgress:function(callBack){$j.get("/nextrun/get-points/?show",function(data,status){var res="Data: "+JSON.stringify(data)+"\nStatus: "+status;console.log(res),"success"===status&&callBack(data)})},_GM:null,_setupRate:function(){var _this=this;this._setupWindow($j("#pages_cont").find("#home").find("#rate"),$j("#rate_popup"),function(){_this._showRate()},!1),this._setupWindow($j("#rate_popup").find("#howto"),$j("#howto_popup"),function(){},!0)},_showRate:function(){function parseTopTen(mypos,data){if("[object Array]"===Object.prototype.toString.call(data)){$j("#rate_popup").find("#toptenblock").empty();for(var i=0;i<data.length;i++){var mark="";data[i].pos==mypos&&(mark="g_rates_mypos_bold"),drawRateLineHtml($j("#rate_popup").find("#toptenblock"),data[i],mark)}}}function parseMyScore(mypos,data){if("[object Array]"===Object.prototype.toString.call(data)){$j("#rate_popup").find("#nearthree").empty();for(var i=0;i<3;i++){var mark="";data[i].pos==mypos&&(mark="g_rates_mypos_bold"),drawRateLineHtml($j("#rate_popup").find("#nearthree"),data[i],mark)}}}function drawRateLineHtml(div,userData,mark){var userDiv="<div>";userData.prize&&userData.prize,userDiv+="<p class='topten_list_user "+mark+"'>"+userData.pos+"    "+userData.name+"</p>",userDiv+="<p class='topten_list_pos "+mark+"'>"+userData.points+"</p>",userDiv+="</div>",div.append(userDiv)}var _this=this,top10link="/nextrun/?rating";0!=window.RateTest&&(top10link="https://jsonplaceholder.typicode.com/users"),$j.get(top10link,function(data,status){1==window.RateTest&&(data=_this._rateResponseData1),2==window.RateTest&&(data=_this._rateResponseData2);var res="Data: "+JSON.stringify(data)+"\nStatus: "+status;console.log(res),data.topten?(parseTopTen(data.mypos,data.topten),data.mypos>data.topten.length?(data.nearthree?parseMyScore(data.mypos,data.nearthree):console.log("not find - data.nearthree"),$j("#rate_popup").find("#myposblock").show(),$j("#rate_popup").find("#ratescroll").css({height:"200px"})):($j("#rate_popup").find("#myposblock").hide(),$j("#rate_popup").find("#ratescroll").css({height:"350px"}))):console.log("not find - data.topten")}),window.dataLayer&&dataLayer.push({event:"capsule game",eventCategory:"capsule game",eventAction:"pageview",eventLabel:"rating"})},_showFriend:function(){},_rateResponseData1:{mypos:10,topten:[{pos:1,name:"first",points:999999,prize:"Lamoda 15 000+"},{pos:2,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:3,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:4,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:5,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:6,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:7,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:8,name:"Имя Игрокаsdsdsdssdssdsdsdsdssddssdsdsd",points:99999,prize:"Lamoda 15 000"},{pos:9,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:10,name:"player",points:99999,prize:"Lamoda 15 000"}]},_rateResponseData2:{mypos:85,topten:[{pos:1,name:"first",points:99999,prize:"Lamoda 15 000+"},{pos:2,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:3,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:4,name:"Имя Игрокаererrere e rer e rr e e ee",points:99999,prize:"Lamoda 15 000"},{pos:5,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:6,name:"Имя Игрокаsdsdsssdsdsdsdsdssdsdsd",points:99999,prize:"Lamoda 15 000"},{pos:7,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:8,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:9,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:10,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"}],nearthree:[{pos:84,name:"Имя Игрока",points:99999,prize:"Lamoda 15 000"},{pos:85,name:"player",points:99999},{pos:86,name:"Имя Игрока",points:99999}]},_setupInvite:function(){function updateInvite(){var n=_this._GM.player.invited,m=_this._GM.player.invitedmax;$j("#invite_popup").find("#count").html(n+"/"+m),n>=m&&($j("#invite_popup").find("#email").prop("disabled",!0),$j("#invite_popup").find("#invite").prop("disabled",!0))}function doInvite(){var json={email:$j("#invite_popup").find("#email").val()};$j.post("https://jsonplaceholder.typicode.com/posts",json,function(data,status){var res="Data: "+JSON.stringify(data)+"\nStatus: "+status;console.log(res),_this._GM.player.invited++,updateInvite()})}var _this=this;this._setupWindow($j("#home").find("#invite"),$j("#invite_popup"),function(){updateInvite()}),$j("#invite_popup").find("#invite").on({click:function(){doInvite()}})},_setupWindow:function(_openButton,_popup,onOpenCallBack,isSubwindow){_openButton.on("click",function(){onOpenCallBack(),$j("#slide_popups_cont").show(),_popup.fadeIn(250)}),_popup.find("#close").on("click",function(){_popup.hide(),isSubwindow||$j("#slide_popups_cont").hide()})},_setupSlider:function(_openButton,_popup,onOpenCallBack,isSubwindow){_openButton.on("click",function(){onOpenCallBack(),_popup.show(),_popup.animate({right:"0px"},400),$j("#slide_popups_cont").show(),$j("#home").addClass("blur_content")}),_popup.find("#close").on("click",function(){_popup.animate({right:"-800px"},400,onComplete=function(){_popup.hide(),isSubwindow||($j("#slide_popups_cont").hide(),$j("#home").removeClass("blur_content"))})})},_setupCheckConnection:function(){function doConnectFunction(){}function doNotConnectFunction(){$j("#game_cont").find("#connectionblock").show(),_this._GM.levelPause()}function doCheck(){var i=new Image;i.onload=doConnectFunction,i.onerror=doNotConnectFunction,i.src="assets/checkconnection.png?d="+Math.round(77777*Math.random())}var _this=this;$j("#game_cont").find("#connectionblock").find("#close").on({click:function(){$j("#game_cont").find("#connectionblock").hide()}}),setInterval(doCheck,7e3)}}),Sounds=Class.create({initialize:function(){var _this=this;this._setupFaceClick();var ext=".ogg";"safari"==window.browserName&&(ext=".mp3"),"IE"==window.browserName&&(ext=".mp3"),isIOS&&(ext=".mp3"),alert(window.browserName+" ,10-22 isIOS = "+isIOS),this._sounds=[{name:"crash",link:"assets/sounds/sfx/crash-1"+ext},{name:"bonus",link:"assets/sounds/sfx/bonus-1"+ext},{name:"bonus-time",link:"assets/sounds/sfx/bonus-time-1"+ext},{name:"capsule",link:"assets/sounds/sfx/capsule-1"+ext},{name:"gyroscooter",link:"assets/sounds/sfx/gyroscooter-1"+ext},{name:"jump",link:"assets/sounds/sfx/jump-1"+ext},{name:"landing",link:"assets/sounds/sfx/landing-1"+ext},{name:"left-right",link:"assets/sounds/sfx/left-right-1"+ext},{name:"new-look",link:"assets/sounds/sfx/new-look-1"+ext},{name:"popup",link:"assets/sounds/sfx/popup-1"+ext},{name:"win-game",link:"assets/sounds/sfx/win-game-1"+ext},{name:"menu",link:"assets/sounds/main_menu_theme"+ext},{name:"loc1_theme",link:"assets/sounds/loc1_theme"+ext},{name:"loc2_theme",link:"assets/sounds/loc2_theme"+ext},{name:"loc3_theme",link:"assets/sounds/loc3_theme"+ext}],this._loadFiles(),this._onloadAll=function(){window.consoleOn&&console.log("sounds loaded"),alert("sounds loaded"),_this.loaded=!0,null!=_this.onloadComplete&&_this.onloadComplete()},setTimeout(function(){0==_this.getLoadingPercent()&&(_this.loaded=!0,window.consoleOn&&console.log("ERROR: sound files not loaded"),alert("ERROR: sound files not loaded"),null!=_this.onloadComplete&&_this.onloadComplete())},5e3)},loaded:!1,onloadComplete:null,onloadProgress:null,getLoadingPercent:function(){return Math.round(this._loadedCount/this._sounds.length*100)},play:function(idName,isLoop){if(!this.muted)for(var _this=this,i=0;i<this._sounds.length;i++)if(idName==this._sounds[i].name){if(isIOS)return void this.fakeClick(function(){_this._sounds[i].audio.currentTime=0,_this._sounds[i].audio.loop=isLoop,_this._sounds[i].audio.play(),_this.muted&&(_this._sounds[i].audio.muted=!0)});if(4==this._sounds[i].audio.readyState)this._sounds[i].audio.currentTime=0,this._sounds[i].audio.loop=isLoop,this._sounds[i].audio.play(),this.muted&&(this._sounds[i].audio.muted=!0);else{var errMsg=this._sounds[i].name+" - not ready";window.consoleOn&&console.log(errMsg),isIOS||(this._sounds[i].audio.currentTime=0,this._sounds[i].audio.loop=isLoop,this._sounds[i].audio.load(),this._sounds[i].audio.play(),this.muted&&(this._sounds[i].audio.muted=!0))}return}},pause:function(idName){if(this.loaded)for(var i=0;i<this._sounds.length;i++)idName==this._sounds[i].name&&this._sounds[i].audio.pause()},mute:function(idName){if(this.loaded)for(var i=0;i<this._sounds.length;i++)idName==this._sounds[i].name&&(this._sounds[i].audio.muted=!0)},unmute:function(idName){if(this.loaded)for(var i=0;i<this._sounds.length;i++)idName==this._sounds[i].name&&(this._sounds[i].audio.muted=!1)},pauseAll:function(){if(this.loaded)for(var i=0;i<this._sounds.length;i++)this._sounds[i].audio.paused?this._sounds[i].wasPaused=!1:(this._sounds[i].wasPaused=!0,this._sounds[i].audio.pause())},rezumeAll:function(){if(this.loaded)for(var i=0;i<this._sounds.length;i++)this._sounds[i].wasPaused&&this._sounds[i].audio.play()},muted:!1,muteAll:function(){if(this.loaded){this.muted=!0;for(var i=0;i<this._sounds.length;i++)this._sounds[i].audio.muted=!0}},unmuteAll:function(){if(this.loaded){this.muted=!1;for(var i=0;i<this._sounds.length;i++)this._sounds[i].audio.muted=!1}},_sounds:null,_onloadAll:null,_loadedCount:0,_loadFiles:function(){function loadNext(i){if(!(i>=_this._sounds.length)){_this._sounds[i].audio=new Audio,_this._sounds[i].status="loading";_this._sounds[i];_this._sounds[i].audio.addEventListener("loadeddata",function(){_this._loadedCount++;var p=_this.getLoadingPercent();null!=_this.onloadProgress&&_this.onloadProgress(p),_this._loadedCount==_this._sounds.length&&null!=_this._onloadAll&&_this._onloadAll(),isIOS||loadNext(++i)}),_this._sounds[i].audio.src=_this._sounds[i].link,_this._sounds[i].audio.preload="auto",_this._sounds[i].audio.load(),isIOS&&_this.fakeClick(function(){_this._sounds[i].audio.load()}),$j(_this._sounds[i].audio).bind("stalled",function(){var audio=this;audio.load(),audio.play(),audio.pause()}),isIOS&&loadNext(++i)}}var _this=this;loadNext(0)},_setupFaceClick:function(){var _this=this,$a=$j('<a href="#" id="fakeClick"></a>');$a.bind("click",function(e){e.preventDefault(),null!=_this._fakeClickFn&&_this._fakeClickFn()}),$j("body").append($a)},_fakeClickFn:null,fakeClick:function(fn){this._fakeClickFn=fn;var evt,el=$j("#fakeClick").get(0);document.createEvent&&(evt=document.createEvent("MouseEvents")).initMouseEvent&&(evt.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),el.dispatchEvent(evt))}}),$j=jQuery.noConflict();window.onload=function(){function prerenderPhone(){if(++_phoneCount>3)return $j("#popups_cont").hide(),$j("#phone_popup").hide(),void $j("#phone_popup").css({top:"0px"});consoleOn&&console.log("prerender phone"),$j("#popups_cont").show(),$j("#phone_popup").show(),$j("#phone_popup").css({top:"3000px"}),$j("#phone_popup").find("#text1").hide(),$j("#phone_popup").find("#text2").hide(),$j("#phone_popup").find("#text3").hide(),$j("#phone_popup").find("#text"+_phoneCount).show(),$j("#phone_popup").find("#picture").attr("src","assets/ui/phone"+_phoneCount+".png"),$j("#phone_popup").find("#picture").css({top:"-30px"}),setTimeout(prerenderPhone,1e3),(new Image).src="assets/ui/phone"+_phoneCount+".png"}function HWtouch(e){0!=LM.isStarted&&e.preventDefault()}function checkOrientation(){isMobile&&!isTablet&&(_isHorizontal=detectHorizontal(),checkorientation?(GV._resize(),_isHorizontal?($j("#rotate_plz").show(),orientation_wrong=!0):orientation_wrong?window.location.reload(!1):checkorientation=!1):(LV.setCanvasSize(),GV._resize(),_isHorizontal?($j("#rotate_plz").show(),$j(".body").scrollTop(0),GM.levelPause()):($j("#rotate_plz").hide(),fixCanvasAndUI_size()))),isMobile&&isTablet&&(fixCanvasAndUI_size(),setTimeout(function(){GM.levelPause()},400))}function fixCanvasAndUI_size(){LV.setCanvasSize(),GV._resize(),setTimeout(function(){LV.setCanvasSize(),GV._resize()},100),setTimeout(function(){LV.setCanvasSize(),GV._resize()},200),setTimeout(function(){LV.setCanvasSize(),GV._resize(),$j("#rotate_plz").hide()},300)}function detectmobile(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))&&(consoleOn&&console.log("mobile"),!0)}function detectHorizontal(){var rez=window.screen.height>window.screen.width;return navigator.userAgent.match(/iPhone/i)&&(rez=window.innerHeight>window.innerWidth),rez}function get_browser(){var tem,ua=navigator.userAgent,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(M[1])?(tem=/\brv[ :]+(\d+)/g.exec(ua)||[],{name:"IE",version:tem[1]||""}):"Chrome"===M[1]&&null!=(tem=ua.match(/\bOPR|Edge\/(\d+)/))?{name:"Opera",version:tem[1]}:(M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(tem=ua.match(/version\/(\d+)/i))&&M.splice(1,1,tem[1]),{name:M[0],version:M[1]})}function addCSS(cssId,_href){if(!document.getElementById(cssId)){var head=document.getElementsByTagName("head")[0],link=document.createElement("link");link.id=cssId,link.rel="stylesheet",link.type="text/css",link.href=_href,link.media="all",head.appendChild(link)}}consoleOn=!0,debugOn=!1,debugRoad=!1,RateTest=0,isBuildToSite=!0,isMobile=detectmobile(),isTablet=function(){return 0!=detectmobile()&&(window.screen.width>=768&&window.screen.height>=768&&(consoleOn&&console.log("tablet"),!0))}(),isTabletPro=function(){return 0!=detectmobile()&&(window.screen.width>=1024&&window.screen.height>=1024&&(consoleOn&&console.log("ipadPro resolution"),!0))}(),isIOS=function(){return!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))&&(consoleOn&&console.log("mobile"),!0)}(),_isHorizontal=detectHorizontal(),browserName=function(){var name="none";(!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0)&&(name="opera"),"undefined"!=typeof InstallTrigger&&(name="firefox"),(/constructor/i.test(window.HTMLElement)||function(p){return"[object SafariRemoteNotification]"===p.toString()}(!window.safari||safari.pushNotification))&&(name="safari");var isIE=!!document.documentMode;return isIE&&(name="IE"),!isIE&&!!window.StyleMedia&&(name="edge"),!!window.chrome&&!!window.chrome.webstore&&(name="chrome"),name}(),function(){isBuildToSite=!1}(),console.log("v 0.20.4 - "+(isBuildToSite?"site":"demo")),isMobile,isMobile&&!isTablet&&$j("#game_cont").css({height:"90vh"}),isMobile||window.initLoaderAnimation();var QM=new QuizModel,QV=new QuizView(QM);new QuizController(QM,QV);sounds=new Sounds;var LM=new ModelLevel,LV=isMobile?new ViewLevel3dMob(LM):new ViewLevel3d(LM),LC=new ControllerLevel(LM,LV),aj=new AjaxContent,GM=new GameModel(LC,QM,aj);GV=new GameView(GM,LC);new GameController(GM,GV);!function(){var browser=get_browser(),name=browser.name,vers=browser.version;$j("#webglblock").find("#browsername").html(name),$j("#webglblock").find("#browserversion").html("version: "+vers),"Chrome"==name&&Number(vers)<56||"Firefox"==name&&Number(vers)<51||"Opera"!=name&&("MSIE"==name&&Number(vers)<11||"Safari"==name&&Number(vers))}(),!function(){if(window.WebGLRenderingContext){for(var canvas=document.createElement("canvas"),names=["webgl","experimental-webgl","moz-webgl","webkit-3d"],context=!1,i=0;i<4;i++)try{if((context=canvas.getContext(names[i]))&&"function"==typeof context.getParameter)return!return_context||{name:names[i],gl:context}}catch(e){}return!0}return $j("#webglblock").find("#webglstatus").html("WebGL not supported"),!1}()?$j("#webglblock").show():GM.init(),isMobile&&null!=window.onAnimationStepComplete&&window.onAnimationStepComplete(),setTimeout(function(){isMobile?$j("#instructions_popup").find("a").attr("style",'font:normal 19px/1 "ProximaNovaRegular",sans-serif;'):$j("#instructions_popup").find("a").attr("style",'font:normal 16px/1 "ProximaNovaRegular",sans-serif;'),$j("#game_cont").find("#home").find(".g_prizelist_title").find("a").attr("style",'20px/1 "ProximaNovaExtraboldItalic",sans-serif;')},2500),$j(window).blur(function(){setTimeout(function(){isMobile&&GM.levelPause()},200)}),$j(window).focus(function(){}),$j("#page_main_loader").hide(),isMobile||($j("#pages_cont").show(),$j("#choose_level").show(),$j("#choose_level").find("#back").hide(),setTimeout(function(){$j("#choose_level").find("#level1").find("#start").addClass("img1hovered"),$j("#choose_level").find("#level2").find("#start").addClass("img2hovered"),$j("#choose_level").find("#level3").find("#start").addClass("img3hovered")},1e3),setTimeout(function(){$j("#choose_level").find("#level1").find("#start").removeClass("img1hovered"),$j("#choose_level").find("#level2").find("#start").removeClass("img2hovered"),$j("#choose_level").find("#level3").find("#start").removeClass("img3hovered"),$j("#choose_level").hide(),$j("#choose_level").find("#back").show()},1200)),$j("#popups_cont").show(),$j("#instructions_popup").show(),_refreshInstruction(!0),$j("#instructions_popup").css({top:"2000px"}),setTimeout(function(){$j("#popups_cont").hide(),$j("#instructions_popup").hide(),$j("#instructions_popup").css({top:"0px"})},2e3);var _phoneCount=0;if(prerenderPhone(),isMobile){var HW=$j(".b-footer__label")[0];HW&&(HW.addEventListener("touchstart",HWtouch,!1),HW.addEventListener("touchmove",HWtouch,!1),HW.addEventListener("touchend",HWtouch,!1))}orientation_wrong=!1,checkorientation=!0,checkOrientation(),$j(window).on("orientationchange",function(){checkOrientation()}),isMobile&&function(){isBuildToSite?isTablet?addCSS("tab_css","/css/game/tablet_adapt.css"):addCSS("mob_css","/css/game/mobile_adapt.css"):isTablet?addCSS("tab_css","css/tablet_adapt.css"):addCSS("mob_css","css/mobile_adapt.css"),$j("#game_cont").find("#loader").find("#mobileloaderimg").show(),$j("#game_cont").find("#loader").find("#prepreloader").removeClass("absolute_centered"),$j("#game_cont").find("#loader").find("#bar_percents").show(),$j("#pages_cont").find("#home").addClass("scrolldiv_y"),$j("#slide_popups_cont").find("#rules_popup").addClass("scrolldiv_y"),$j("#slide_popups_cont").find("#rate_popup").addClass("scrolldiv_y"),$j("#slide_popups_cont").find("#invite_popup").addClass("scrolldiv_y"),$j("#popups_cont").find("#quiz_play_popup").addClass("scrolldiv_y");var scaleClass="scalediv85";isTablet&&(scaleClass=""),$j("#game_cont").each(function(){$j(this).find(".scaleifmobile").addClass(scaleClass)}),$j("g_finish_quiz").addClass("no-hover"),$j("g_finish_home").addClass("no-hover"),$j("g_finish_replay").addClass("no-hover"),$j("#esc_for_pause_img").hide(),isTablet&&($j("#finish_page").css({"background-size":"cover"}),_isHorizontal&&$j("#finish_page").css({"background-position":"60%"}),$j("#quiz_play_popup").css({"background-size":"cover"}),_isHorizontal&&$j("#quiz_play_popup").css({"background-position":"52%"})),isTablet&&isTabletPro&&($j(".g_mainfon").css({"background-size":"cover"}),$j(".g_infofon").css({"background-size":"cover"}),$j(".g_levelsfon").css({"background-size":"cover"}),$j(".g_popupfon").css({"background-size":"cover"}),$j(".g_slider_fon").css({"background-size":"cover"}),$j(".g_howto_fon").css({"background-size":"cover"}),$j("#finish_page").css({"background-size":"cover"}),_isHorizontal&&$j("#finish_page").css({"background-position":"60%"}),$j("#quiz_play_popup").css({"background-size":"cover"}),_isHorizontal&&$j("#quiz_play_popup").css({"background-position":"60%"})),$j(".er_homeprizes").hide(),$j(".er_homeprizes_mob").show(),$j(".er_main_mob_pic").show(),setupMobilePrizesSlider()}(),debugOn};